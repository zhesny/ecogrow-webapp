<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EcoGrow - –£–¥–∞–ª—ë–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css">
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary-color: #28a745;
            --secondary-color: #17a2b8;
            --dark-color: #343a40;
        }
        
        .device-card {
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: transform 0.3s;
            margin-bottom: 20px;
            background: white;
        }
        
        .device-card:hover {
            transform: translateY(-5px);
        }
        
        .moisture-indicator {
            height: 20px;
            border-radius: 10px;
            background: linear-gradient(90deg, #dc3545 0%, #ffc107 50%, #28a745 100%);
            position: relative;
            margin: 10px 0;
        }
        
        .moisture-pointer {
            position: absolute;
            top: -5px;
            width: 3px;
            height: 30px;
            background: #000;
            transform: translateX(-50%);
            transition: left 0.5s ease;
        }
        
        .status-online {
            color: #28a745;
        }
        
        .status-offline {
            color: #dc3545;
        }
        
        .btn-action {
            width: 100px;
            margin: 5px;
        }
        
        #moistureChart {
            max-height: 300px;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            min-width: 300px;
        }
        
        .connection-badge {
            font-size: 0.8rem;
            padding: 3px 8px;
            border-radius: 10px;
        }
        
        .connection-firebase {
            background: #ff9800;
            color: white;
        }
        
        .connection-local {
            background: #4caf50;
            color: white;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="#">
                <i class="bi bi-tree-fill"></i> EcoGrow Remote Control
            </a>
            <div>
                <span id="connectionStatus" class="connection-badge connection-firebase">
                    <i class="bi bi-cloud"></i> Firebase
                </span>
                <span id="deviceStatus" class="connection-badge ms-2" style="background: #6c757d;">
                    <i class="bi bi-question-circle"></i> –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...
                </span>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <div class="row">
            <div class="col-lg-8">
                <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ -->
                <div class="device-card card">
                    <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">
                            <i class="bi bi-speedometer2"></i> –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
                        </h5>
                        <div id="lastUpdate" class="text-white-50 small">--:--</div>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-4">
                                    <h6><i class="bi bi-droplet"></i> –í–ª–∞–∂–Ω–æ—Å—Ç—å –ø–æ—á–≤—ã</h6>
                                    <div class="d-flex align-items-center">
                                        <h1 id="moistureValue" class="display-4 me-3 text-primary">--%</h1>
                                        <div class="flex-grow-1">
                                            <div class="moisture-indicator">
                                                <div id="moisturePointer" class="moisture-pointer" style="left: 50%;"></div>
                                            </div>
                                            <div class="d-flex justify-content-between mt-1 small">
                                                <span class="text-danger">–°—É—Ö–æ</span>
                                                <span class="text-success">–í–ª–∞–∂–Ω–æ</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="mt-2">
                                        <small class="text-muted" id="moistureStatus">–û–∂–∏–¥–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö...</small>
                                    </div>
                                </div>
                                
                                <div class="mb-4">
                                    <h6><i class="bi bi-sliders"></i> –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ—Ä–æ–≥–∞</h6>
                                    <div class="d-flex align-items-center">
                                        <input type="range" class="form-range flex-grow-1" id="thresholdSlider" 
                                               min="10" max="90" step="5" value="50">
                                        <span id="thresholdValue" class="ms-3 badge bg-info fs-6">50%</span>
                                    </div>
                                    <button id="setThresholdBtn" class="btn btn-sm btn-primary mt-2">
                                        <i class="bi bi-check-lg"></i> –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–æ—Ä–æ–≥
                                    </button>
                                </div>
                            </div>
                            
                            <div class="col-md-6">
                                <div class="mb-4">
                                    <h6><i class="bi bi-play-circle"></i> –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞—Å–æ—Å–æ–º</h6>
                                    <div class="alert" id="pumpAlert">
                                        <div class="d-flex justify-content-between">
                                            <span>–°—Ç–∞—Ç—É—Å:</span>
                                            <strong id="pumpStatusText">–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ</strong>
                                        </div>
                                    </div>
                                    <div class="btn-group d-flex">
                                        <button class="btn btn-success btn-action" onclick="sendCommand('pump', 'ON')">
                                            <i class="bi bi-play-fill"></i> –í–ö–õ
                                        </button>
                                        <button class="btn btn-danger btn-action" onclick="sendCommand('pump', 'OFF')">
                                            <i class="bi bi-stop-fill"></i> –í–´–ö–õ
                                        </button>
                                        <button class="btn btn-warning btn-action" onclick="sendCommand('pump', 'AUTO')">
                                            <i class="bi bi-arrow-repeat"></i> –ê–í–¢–û
                                        </button>
                                    </div>
                                    <div class="mt-2">
                                        <button class="btn btn-outline-primary btn-sm w-100" onclick="manualWatering()">
                                            <i class="bi bi-droplet"></i> –ü–æ–ª–∏—Ç—å —Å–µ–π—á–∞—Å (10 —Å–µ–∫)
                                        </button>
                                    </div>
                                </div>
                                
                                <div class="mb-4">
                                    <h6><i class="bi bi-lightbulb"></i> –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–≤–µ—Ç–æ–º</h6>
                                    <div class="alert" id="lightAlert">
                                        <div class="d-flex justify-content-between">
                                            <span>–°—Ç–∞—Ç—É—Å:</span>
                                            <strong id="lightStatusText">–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ</strong>
                                        </div>
                                    </div>
                                    <div class="btn-group d-flex">
                                        <button class="btn btn-warning btn-action" onclick="sendCommand('light', 'ON')">
                                            <i class="bi bi-lightbulb-fill"></i> –í–ö–õ
                                        </button>
                                        <button class="btn btn-secondary btn-action" onclick="sendCommand('light', 'OFF')">
                                            <i class="bi bi-lightbulb"></i> –í–´–ö–õ
                                        </button>
                                        <button class="btn btn-info btn-action" onclick="sendCommand('light', 'AUTO')">
                                            <i class="bi bi-arrow-repeat"></i> –ê–í–¢–û
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- –ì—Ä–∞—Ñ–∏–∫ -->
                        <div class="mt-4">
                            <h6><i class="bi bi-graph-up"></i> –ò—Å—Ç–æ—Ä–∏—è –≤–ª–∞–∂–Ω–æ—Å—Ç–∏ (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 10 –∏–∑–º–µ—Ä–µ–Ω–∏–π)</h6>
                            <canvas id="moistureChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-lg-4">
                <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ -->
                <div class="device-card card">
                    <div class="card-header bg-info text-white">
                        <h5 class="mb-0"><i class="bi bi-gear"></i> –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã</h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <h6>–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–ª–∏–≤–∞</h6>
                            <div class="input-group mb-2">
                                <span class="input-group-text"><i class="bi bi-clock"></i></span>
                                <input type="number" id="wateringDuration" class="form-control" 
                                       placeholder="–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (—Å–µ–∫)" min="1" max="300">
                                <button class="btn btn-outline-primary" onclick="updateSetting('wateringDuration')">
                                    –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                                </button>
                            </div>
                            <div class="input-group">
                                <span class="input-group-text"><i class="bi bi-hourglass"></i></span>
                                <input type="number" id="wateringDelay" class="form-control" 
                                       placeholder="–ó–∞–¥–µ—Ä–∂–∫–∞ (–º–∏–Ω)" min="1" max="1440">
                                <button class="btn btn-outline-primary" onclick="updateSetting('wateringDelay')">
                                    –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                                </button>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <h6>–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ —Å–≤–µ—Ç–∞</h6>
                            <div class="row g-2 mb-2">
                                <div class="col">
                                    <input type="time" id="lampStart" class="form-control" placeholder="–í–∫–ª—é—á–µ–Ω–∏–µ">
                                </div>
                                <div class="col">
                                    <input type="time" id="lampEnd" class="form-control" placeholder="–í—ã–∫–ª—é—á–µ–Ω–∏–µ">
                                </div>
                            </div>
                            <button class="btn btn-primary w-100" onclick="updateLightSchedule()">
                                <i class="bi bi-save"></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ
                            </button>
                        </div>
                        
                        <div class="mb-3">
                            <h6>–†–µ–∂–∏–º —Å–Ω–∞</h6>
                            <div class="form-check form-switch mb-2">
                                <input class="form-check-input" type="checkbox" id="sleepEnabled">
                                <label class="form-check-label" for="sleepEnabled">–í–∫–ª—é—á–∏—Ç—å —Ä–µ–∂–∏–º —Å–Ω–∞</label>
                            </div>
                            <div class="row g-2">
                                <div class="col">
                                    <input type="time" id="sleepStart" class="form-control" placeholder="–ù–∞—á–∞–ª–æ">
                                </div>
                                <div class="col">
                                    <input type="time" id="sleepEnd" class="form-control" placeholder="–ö–æ–Ω–µ—Ü">
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-3">
                            <button class="btn btn-outline-success w-100" onclick="syncSettings()">
                                <i class="bi bi-arrow-clockwise"></i> –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
                <div class="device-card card mt-3">
                    <div class="card-header bg-success text-white">
                        <h5 class="mb-0"><i class="bi bi-bar-chart"></i> –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h5>
                    </div>
                    <div class="card-body">
                        <div class="row text-center">
                            <div class="col-6 mb-3">
                                <div class="display-6 text-primary" id="totalWaterings">0</div>
                                <small class="text-muted">–í—Å–µ–≥–æ –ø–æ–ª–∏–≤–æ–≤</small>
                            </div>
                            <div class="col-6 mb-3">
                                <div class="display-6 text-warning" id="totalLightHours">0</div>
                                <small class="text-muted">–ß–∞—Å–æ–≤ —Å–≤–µ—Ç–∞</small>
                            </div>
                            <div class="col-6">
                                <div class="display-6 text-info" id="todayWaterings">0</div>
                                <small class="text-muted">–ü–æ–ª–∏–≤–æ–≤ —Å–µ–≥–æ–¥–Ω—è</small>
                            </div>
                            <div class="col-6">
                                <div class="display-6 text-secondary" id="energyUsed">0</div>
                                <small class="text-muted">–í—Ç¬∑—á —ç–Ω–µ—Ä–≥–∏–∏</small>
                            </div>
                        </div>
                        <div class="mt-3">
                            <div class="d-flex justify-content-between small">
                                <span>–¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è —Å–∏—Å—Ç–µ–º—ã:</span>
                                <strong id="systemTime">--:--</strong>
                            </div>
                            <div class="d-flex justify-content-between small">
                                <span>IP —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞:</span>
                                <strong id="deviceIP">---.---.---.---</strong>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- –ë—ã—Å—Ç—Ä—ã–µ –∫–æ–º–∞–Ω–¥—ã -->
                <div class="device-card card mt-3">
                    <div class="card-header bg-warning text-dark">
                        <h5 class="mb-0"><i class="bi bi-lightning"></i> –ë—ã—Å—Ç—Ä—ã–µ –∫–æ–º–∞–Ω–¥—ã</h5>
                    </div>
                    <div class="card-body">
                        <div class="row g-2">
                            <div class="col-6">
                                <button class="btn btn-outline-success w-100" onclick="quickCommand('PUMP_ON_10')">
                                    üíß –ü–æ–ª–∏–≤ 10—Å
                                </button>
                            </div>
                            <div class="col-6">
                                <button class="btn btn-outline-warning w-100" onclick="quickCommand('LIGHT_ON_1H')">
                                    üí° –°–≤–µ—Ç 1—á
                                </button>
                            </div>
                            <div class="col-6">
                                <button class="btn btn-outline-danger w-100" onclick="quickCommand('ALL_OFF')">
                                    ‚õî –í—Å—ë –≤—ã–∫–ª.
                                </button>
                            </div>
                            <div class="col-6">
                                <button class="btn btn-outline-info w-100" onclick="quickCommand('ALL_AUTO')">
                                    ü§ñ –í—Å—ë –∞–≤—Ç–æ
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–∞—è –ø–∞–Ω–µ–ª—å -->
        <div class="row mt-3">
            <div class="col-12">
                <div class="device-card card">
                    <div class="card-header bg-dark text-white">
                        <h5 class="mb-0"><i class="bi bi-info-circle"></i> –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–∏—Å—Ç–µ–º–µ</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-4">
                                <h6><i class="bi bi-wifi"></i> –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ</h6>
                                <p class="small">–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ Firebase –¥–ª—è —É–¥–∞–ª—ë–Ω–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è. –õ–æ–∫–∞–ª—å–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –¥–∏—Å–ø–ª–µ–π –∏ —ç–Ω–∫–æ–¥–µ—Ä –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å.</p>
                            </div>
                            <div class="col-md-4">
                                <h6><i class="bi bi-shield-check"></i> –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å</h6>
                                <p class="small">–î–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ –∑–∞—â–∏—â—ë–Ω–Ω–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ —Ç–æ–ª—å–∫–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º.</p>
                            </div>
                            <div class="col-md-4">
                                <h6><i class="bi bi-phone"></i> –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å</h6>
                                <p class="small">–£–ø—Ä–∞–≤–ª—è–π—Ç–µ —Å–∏—Å—Ç–µ–º–æ–π —Å –ª—é–±–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞: –∫–æ–º–ø—å—é—Ç–µ—Ä–∞, –ø–ª–∞–Ω—à–µ—Ç–∞ –∏–ª–∏ —Å–º–∞—Ä—Ç—Ñ–æ–Ω–∞ –∏–∑ –ª—é–±–æ–π —Ç–æ—á–∫–∏ –º–∏—Ä–∞.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
    <div id="notificationContainer" class="position-fixed top-0 end-0 p-3" style="z-index: 1050"></div>

    <script src="app.js"></script>
</body>
</html>
