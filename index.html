<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EcoGrow Assistant</title>
    
    <!-- –£–±–∏—Ä–∞–µ–º CSP –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ -->
    
    <!-- –ò–∫–æ–Ω–∫–∏ -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Firebase 8.10.1 -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    
    <style>
        /* –ë–ê–ó–û–í–´–ï –°–¢–ò–õ–ò */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; background: #0f172a; color: white; }
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
        
        /* Header */
        .header { background: #1e293b; padding: 15px 0; border-bottom: 2px solid #334155; }
        .header-content { display: flex; justify-content: space-between; align-items: center; }
        .logo { display: flex; align-items: center; gap: 10px; }
        .logo i { color: #10b981; font-size: 2rem; }
        .logo h1 { font-size: 1.5rem; }
        
        /* Status Dot */
        .status-dot { width: 10px; height: 10px; border-radius: 50%; display: inline-block; margin-right: 8px; }
        .status-connected { background: #10b981; }
        .status-disconnected { background: #ef4444; }
        
        /* Cards */
        .stats-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin: 20px 0; }
        @media (max-width: 768px) {
            .stats-grid { grid-template-columns: 1fr; }
        }
        
        .stat-card { 
            background: #1e293b; 
            padding: 20px; 
            border-radius: 10px; 
            border-left: 4px solid #3b82f6;
            transition: transform 0.3s ease;
        }
        .stat-card:hover { transform: translateY(-5px); }
        
        .stat-card.warning { border-left-color: #f59e0b; }
        .stat-card.success { border-left-color: #10b981; }
        .stat-card.danger { border-left-color: #ef4444; }
        
        .stat-icon { 
            font-size: 2rem; 
            margin-bottom: 10px; 
            color: #3b82f6; 
        }
        .stat-card.warning .stat-icon { color: #f59e0b; }
        .stat-card.success .stat-icon { color: #10b981; }
        .stat-card.danger .stat-icon { color: #ef4444; }
        
        .stat-value { 
            font-size: 2.5rem; 
            font-weight: bold; 
            margin: 10px 0; 
            font-family: 'Courier New', monospace;
        }
        
        .stat-trend { 
            font-size: 0.9rem; 
            color: #94a3b8; 
            margin-top: 5px; 
        }
        
        /* Main Layout */
        .main-layout { 
            display: grid; 
            grid-template-columns: 2fr 1fr; 
            gap: 20px; 
            margin-top: 20px;
        }
        @media (max-width: 1024px) {
            .main-layout { grid-template-columns: 1fr; }
        }
        
        .section { 
            background: #1e293b; 
            padding: 20px; 
            border-radius: 10px; 
            margin-bottom: 20px; 
        }
        
        .section h2 { 
            margin-bottom: 20px; 
            color: #e2e8f0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        /* Chart */
        .chart-wrapper { 
            height: 300px; 
            position: relative;
            margin-bottom: 20px;
        }
        
        /* Controls */
        .controls-grid { 
            display: grid; 
            grid-template-columns: 1fr 1fr; 
            gap: 20px; 
            margin-top: 20px;
        }
        @media (max-width: 768px) {
            .controls-grid { grid-template-columns: 1fr; }
        }
        
        .control-group { 
            background: #0f172a; 
            padding: 15px; 
            border-radius: 8px; 
        }
        
        .control-group h3 { 
            margin-bottom: 15px; 
            color: #cbd5e1;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .slider-container { margin: 15px 0; }
        .slider-container label { display: block; margin-bottom: 5px; color: #94a3b8; }
        
        .slider-wrapper {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .slider { 
            flex: 1;
            -webkit-appearance: none;
            height: 8px;
            background: linear-gradient(to right, #ef4444, #f59e0b, #10b981);
            border-radius: 4px;
            outline: none;
        }
        
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            background: white;
            border: 2px solid #3b82f6;
            border-radius: 50%;
            cursor: pointer;
        }
        
        .slider-value { 
            min-width: 40px; 
            text-align: center; 
            font-weight: bold;
            font-size: 1.1rem;
        }
        
        .manual-controls { 
            display: flex; 
            flex-direction: column; 
            gap: 15px; 
        }
        
        .control-btn { 
            background: #3b82f6;
            color: white;
            border: none;
            padding: 15px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: all 0.3s ease;
        }
        
        .control-btn:hover { 
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(59, 130, 246, 0.4);
        }
        
        .control-btn.active { 
            background: #10b981; 
        }
        
        .control-btn.warning { 
            background: #f59e0b; 
        }
        
        /* Status List */
        .status-list { margin: 20px 0; }
        .status-item { 
            display: flex; 
            justify-content: space-between; 
            align-items: center;
            padding: 12px 15px; 
            background: #0f172a; 
            margin: 8px 0; 
            border-radius: 8px; 
            border-left: 4px solid #334155;
        }
        
        .status-item.online { border-left-color: #10b981; }
        .status-item.warning { border-left-color: #f59e0b; }
        .status-item.error { border-left-color: #ef4444; }
        
        .status-item i { font-size: 1.2rem; width: 24px; }
        
        .status-badge { 
            padding: 4px 12px; 
            background: rgba(16, 185, 129, 0.1); 
            color: #10b981; 
            border-radius: 20px; 
            font-size: 0.85rem; 
            font-weight: 500; 
        }
        
        .status-item.error .status-badge { 
            background: rgba(239, 68, 68, 0.1); 
            color: #ef4444; 
        }
        
        .status-item.warning .status-badge { 
            background: rgba(245, 158, 11, 0.1); 
            color: #f59e0b; 
        }
        
        /* Footer */
        .footer { 
            margin-top: 30px; 
            padding-top: 20px; 
            border-top: 1px solid #334155; 
            text-align: center; 
            color: #94a3b8;
        }
        
        /* Toast */
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #1e293b;
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            display: flex;
            align-items: center;
            gap: 12px;
            z-index: 1000;
            animation: slideIn 0.3s ease;
            max-width: 350px;
        }
        
        .toast.success { border-left: 4px solid #10b981; }
        .toast.error { border-left: 4px solid #ef4444; }
        .toast.warning { border-left: 4px solid #f59e0b; }
        .toast.info { border-left: 4px solid #3b82f6; }
        
        @keyframes slideIn {
            from { transform: translateX(100px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes slideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100px); opacity: 0; }
        }
        
        /* No Data Message */
        .no-data { 
            text-align: center; 
            padding: 40px 20px; 
            color: #94a3b8; 
        }
        
        .no-data i { 
            font-size: 3rem; 
            margin-bottom: 15px; 
            color: #64748b; 
        }
        
        /* Loading */
        .loading { 
            text-align: center; 
            padding: 30px; 
            color: #94a3b8; 
        }
        
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid #334155;
            border-top-color: #3b82f6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Preloader */
        #preloader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #0f172a;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.5s ease;
        }
        
        .preloader-content {
            text-align: center;
        }
        
        .preloader-spinner {
            font-size: 3rem;
            color: #10b981;
            margin-bottom: 20px;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.7; }
        }
        
        /* Time */
        .current-time {
            font-size: 1.8rem;
            font-family: 'Courier New', monospace;
            font-weight: bold;
            color: #3b82f6;
            margin: 10px 0;
            text-align: center;
        }
        
        /* Error History */
        .error-item {
            background: rgba(239, 68, 68, 0.1);
            border-left: 4px solid #ef4444;
            padding: 12px;
            margin: 8px 0;
            border-radius: 6px;
        }
        
        .error-time {
            font-size: 0.85rem;
            color: #94a3b8;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <!-- Preloader -->
    <div id="preloader">
        <div class="preloader-content">
            <div class="preloader-spinner">
                <i class="fas fa-seedling"></i>
            </div>
            <div>–ó–∞–≥—Ä—É–∑–∫–∞ EcoGrow Assistant...</div>
            <div style="margin-top: 10px; font-size: 0.9rem; color: #94a3b8;" id="preloaderStatus">–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã</div>
        </div>
    </div>

    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <i class="fas fa-seedling"></i>
                    <h1>EcoGrow Assistant</h1>
                </div>
                <div id="connectionStatus" style="display: flex; align-items: center; gap: 10px;">
                    <div class="status-dot" id="statusDot" style="background: #f59e0b;"></div>
                    <span id="statusText">–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...</span>
                    <span id="lastUpdate" style="margin-left: 15px; font-size: 0.9rem; color: #94a3b8;">--:--:--</span>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container">
        <!-- Top Stats - 3 –∫–∞—Ä—Ç–æ—á–∫–∏ –≤–º–µ—Å—Ç–æ 4 (—É–±—Ä–∞–Ω–∞ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞) -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-tint"></i>
                </div>
                <h3>–í–ª–∞–∂–Ω–æ—Å—Ç—å –ø–æ—á–≤—ã</h3>
                <div class="stat-value" id="moistureValue">--%</div>
                <div class="stat-trend" id="moistureTrend">‚Üó –ó–∞–≥—Ä—É–∑–∫–∞...</div>
            </div>
            
            <div class="stat-card warning">
                <div class="stat-icon">
                    <i class="fas fa-sun"></i>
                </div>
                <h3>–°–≤–µ—Ç</h3>
                <div class="stat-value" id="lightStatus">–í–´–ö–õ</div>
                <div class="stat-trend" id="lightTimer">--:--</div>
            </div>
            
            <div class="stat-card success">
                <div class="stat-icon">
                    <i class="fas fa-water"></i>
                </div>
                <h3>–ù–∞—Å–æ—Å</h3>
                <div class="stat-value" id="pumpStatus">–í–´–ö–õ</div>
                <div class="stat-trend" id="pumpTimer">--:--</div>
            </div>
        </div>

        <div class="main-layout">
            <!-- Left Column: Chart & Controls -->
            <div>
                <!-- Chart -->
                <div class="section">
                    <h2><i class="fas fa-chart-line"></i> –ì—Ä–∞—Ñ–∏–∫ –≤–ª–∞–∂–Ω–æ—Å—Ç–∏</h2>
                    <div class="chart-wrapper">
                        <canvas id="moistureChart"></canvas>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-top: 20px;">
                        <div style="text-align: center;">
                            <div style="font-size: 0.9rem; color: #94a3b8;">–°—Ä–µ–¥–Ω—è—è</div>
                            <div class="stat-value" style="font-size: 1.5rem;" id="avgMoisture">--%</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 0.9rem; color: #94a3b8;">–ú–∏–Ω–∏–º—É–º</div>
                            <div class="stat-value" style="font-size: 1.5rem;" id="minMoisture">--%</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 0.9rem; color: #94a3b8;">–ú–∞–∫—Å–∏–º—É–º</div>
                            <div class="stat-value" style="font-size: 1.5rem;" id="maxMoisture">--%</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 0.9rem; color: #94a3b8;">–¢—Ä–µ–Ω–¥</div>
                            <div class="stat-value" style="font-size: 1.5rem;" id="trendValue">‚Üí</div>
                        </div>
                    </div>
                </div>
                
                <!-- Controls -->
                <div class="section">
                    <h2><i class="fas fa-sliders-h"></i> –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º–æ–π</h2>
                    <div class="controls-grid">
                        <div class="control-group">
                            <h3><i class="fas fa-cogs"></i> –ê–≤—Ç–æ–ø–æ–ª–∏–≤</h3>
                            <div style="margin-bottom: 20px;">
                                <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                    <input type="checkbox" id="autoWateringToggle" checked style="width: 18px; height: 18px;">
                                    <span>–ê–≤—Ç–æ–ø–æ–ª–∏–≤ –≤–∫–ª—é—á–µ–Ω</span>
                                </label>
                            </div>
                            
                            <div class="slider-container">
                                <label>–ü–æ—Ä–æ–≥ –≤–ª–∞–∂–Ω–æ—Å—Ç–∏:</label>
                                <div class="slider-wrapper">
                                    <input type="range" id="moistureThreshold" min="10" max="90" value="50" class="slider">
                                    <span class="slider-value" id="thresholdValue">50%</span>
                                </div>
                            </div>
                            
                            <div style="margin: 15px 0;">
                                <label>–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø–æ–ª–∏–≤–∞ (—Å–µ–∫):</label>
                                <input type="number" id="pumpDuration" min="1" max="300" value="10" style="width: 100%; padding: 8px; background: #0f172a; border: 1px solid #334155; border-radius: 5px; color: white; margin-top: 5px;">
                            </div>
                        </div>
                        
                        <div class="control-group">
                            <h3><i class="fas fa-hand-paper"></i> –†—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</h3>
                            <div class="manual-controls">
                                <button class="control-btn" id="togglePumpBtn">
                                    <i class="fas fa-water"></i>
                                    <span id="pumpBtnText">–í–∫–ª—é—á–∏—Ç—å –Ω–∞—Å–æ—Å</span>
                                </button>
                                <button class="control-btn warning" id="toggleLightBtn">
                                    <i class="fas fa-lightbulb"></i>
                                    <span id="lightBtnText">–í–∫–ª—é—á–∏—Ç—å —Å–≤–µ—Ç</span>
                                </button>
                                
                                <div style="margin-top: 15px;">
                                    <label>–ë—ã—Å—Ç—Ä—ã–π –ø–æ–ª–∏–≤ (—Å–µ–∫):</label>
                                    <div style="display: flex; gap: 10px; margin-top: 5px;">
                                        <button class="control-btn" style="flex: 1; padding: 10px; background: #3b82f6;" onclick="quickWater(5)">5—Å</button>
                                        <button class="control-btn" style="flex: 1; padding: 10px; background: #3b82f6;" onclick="quickWater(10)">10—Å</button>
                                        <button class="control-btn" style="flex: 1; padding: 10px; background: #3b82f6;" onclick="quickWater(30)">30—Å</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Column: Status & Info -->
            <div>
                <!-- System Status -->
                <div class="section">
                    <h2><i class="fas fa-heartbeat"></i> –°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã</h2>
                    <div id="statusContainer">
                        <div class="loading">
                            <div class="loading-spinner"></div>
                            <div>–ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç—É—Å–∞...</div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 25px;">
                        <h3><i class="fas fa-clock"></i> –°–∏—Å—Ç–µ–º–Ω–æ–µ –≤—Ä–µ–º—è</h3>
                        <div class="current-time" id="currentTime">--:--:--</div>
                        <div style="text-align: center; margin-top: 10px;">
                            <button class="control-btn" style="background: #475569; padding: 10px 20px;" id="syncTimeBtn">
                                <i class="fas fa-sync-alt"></i> –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –≤—Ä–µ–º—è
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Error History -->
                <div class="section">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <h2 style="margin: 0;"><i class="fas fa-exclamation-triangle"></i> –ò—Å—Ç–æ—Ä–∏—è –æ—à–∏–±–æ–∫</h2>
                        <button id="clearErrorsBtn" style="background: transparent; color: #94a3b8; border: 1px solid #475569; padding: 5px 10px; border-radius: 5px; cursor: pointer;">
                            <i class="fas fa-trash"></i> –û—á–∏—Å—Ç–∏—Ç—å
                        </button>
                    </div>
                    
                    <div id="errorList">
                        <div class="no-data">
                            <i class="fas fa-check-circle"></i>
                            <p>–û—à–∏–±–æ–∫ –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer class="footer container">
        <p>EcoGrow Assistant v4.5 | –†–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–æ –ö—É–ø—á–µ–Ω—è –ï–≤–≥–µ–Ω–∏–µ–º</p>
        <p style="margin-top: 5px; font-size: 0.9rem;">–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–æ–ª–∏–≤–∞ —Ä–∞—Å—Ç–µ–Ω–∏–π</p>
        <p style="margin-top: 10px; font-size: 0.8rem; color: #64748b;">–í—Ä–µ–º—è —Å–µ—Ä–≤–µ—Ä–∞: <span id="serverTime">--:--:--</span> | –ê–ø—Ç–∞–π–º: <span id="uptime">--</span></p>
    </footer>

    <!-- Toast Container -->
    <div id="toastContainer"></div>

    <!-- Firebase Initialization -->
    <script>
        // –ü—Ä–æ—Å—Ç–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyBsZr7vWJDFt_S5i0Rvj6ejp6QT0JX9SPk",
            authDomain: "ecogrow-remote.firebaseapp.com",
            databaseURL: "https://ecogrow-remote-default-rtdb.firebaseio.com",
            projectId: "ecogrow-remote",
            storageBucket: "ecogrow-remote.firebasestorage.app",
            messagingSenderId: "121689275158",
            appId: "1:121689275158:web:f3b1829755c8b8a1fb2e37",
            measurementId: "G-PG5116NH38"
        };
        
        console.log('üî• –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase...');
        
        try {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∑–∞–≥—Ä—É–∂–µ–Ω –ª–∏ Firebase
            if (typeof firebase === 'undefined') {
                console.error('‚ùå Firebase SDK –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω!');
                throw new Error('Firebase SDK –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω');
            }
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º Firebase
            firebase.initializeApp(firebaseConfig);
            const database = firebase.database();
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –≥–ª–æ–±–∞–ª—å–Ω—É—é –æ–±–ª–∞—Å—Ç—å
            window.firebaseDatabase = database;
            
            console.log('‚úÖ Firebase –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
            
            // –¢–µ—Å—Ç–∏—Ä—É–µ–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
            database.ref('.info/connected').on('value', (snap) => {
                console.log('üì° Firebase –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ:', snap.val() ? '‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–æ' : '‚ùå –û—Ç–∫–ª—é—á–µ–Ω–æ');
            });
            
        } catch (error) {
            console.error('‚ùå –û—à–∏–±–∫–∞ Firebase:', error);
            window.firebaseDatabase = null;
        }
    </script>
    
    <!-- Main App -->
    <script>
        class EcoGrowApp {
            constructor() {
                this.db = window.firebaseDatabase;
                this.data = {
                    moisture: 0,
                    pump: 0,
                    light: 0,
                    temperature: null,
                    humidity: null,
                    timestamp: 0
                };
                this.chart = null;
                this.chartData = [];
                this.isConnected = false;
                this.lastUpdateTime = 0;
                
                console.log('üöÄ –ó–∞–ø—É—Å–∫ EcoGrow Assistant...');
                
                // –°—Ä–∞–∑—É –∑–∞–ø—É—Å–∫–∞–µ–º
                this.init();
            }
            
            init() {
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –ø—Ä–µ–ª–æ–∞–¥–µ—Ä–∞
                document.getElementById('preloaderStatus').textContent = '–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Firebase...';
                
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –≥—Ä–∞—Ñ–∏–∫
                this.initChart();
                
                // –ù–∞–∑–Ω–∞—á–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
                this.setupEventListeners();
                
                // –ó–∞–ø—É—Å–∫–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏
                this.startTimers();
                
                // –ó–∞–ø—É—Å–∫–∞–µ–º —Å–ª—É—à–∞—Ç–µ–ª–∏ Firebase
                if (this.db) {
                    this.startFirebaseListeners();
                    this.showToast('‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ Firebase', 'success');
                } else {
                    this.showToast('‚ö†Ô∏è Firebase –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω, —Ä–∞–±–æ—Ç–∞ –≤ –ª–æ–∫–∞–ª—å–Ω–æ–º —Ä–µ–∂–∏–º–µ', 'warning');
                    this.startLocalMode();
                }
                
                // –°–∫—Ä—ã–≤–∞–µ–º –ø—Ä–µ–ª–æ–∞–¥–µ—Ä
                setTimeout(() => {
                    document.getElementById('preloader').style.opacity = '0';
                    setTimeout(() => {
                        document.getElementById('preloader').style.display = 'none';
                    }, 500);
                }, 1500);
            }
            
            initChart() {
                const ctx = document.getElementById('moistureChart').getContext('2d');
                
                // –£–Ω–∏—á—Ç–æ–∂–∞–µ–º —Å—Ç–∞—Ä—ã–π –≥—Ä–∞—Ñ–∏–∫ –µ—Å–ª–∏ –µ—Å—Ç—å
                if (this.chart) {
                    this.chart.destroy();
                }
                
                this.chart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: Array.from({length: 24}, (_, i) => {
                            const hour = (new Date().getHours() - (23 - i) + 24) % 24;
                            return hour.toString().padStart(2, '0') + ':00';
                        }),
                        datasets: [{
                            label: '–í–ª–∞–∂–Ω–æ—Å—Ç—å %',
                            data: Array(24).fill(null),
                            borderColor: '#3b82f6',
                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                            borderWidth: 2,
                            fill: true,
                            tension: 0.4,
                            pointBackgroundColor: '#3b82f6',
                            pointBorderColor: '#ffffff',
                            pointBorderWidth: 2,
                            pointRadius: 3
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { 
                            legend: { display: false },
                            tooltip: {
                                mode: 'index',
                                intersect: false,
                                callbacks: {
                                    label: (context) => `–í–ª–∞–∂–Ω–æ—Å—Ç—å: ${context.parsed.y}%`
                                }
                            }
                        },
                        scales: {
                            x: { 
                                grid: { color: 'rgba(255,255,255,0.1)' }, 
                                ticks: { color: '#94a3b8' } 
                            },
                            y: { 
                                min: 0, 
                                max: 100,
                                grid: { color: 'rgba(255,255,255,0.1)' }, 
                                ticks: { 
                                    color: '#94a3b8', 
                                    callback: v => v + '%' 
                                }
                            }
                        }
                    }
                });
            }
            
            startFirebaseListeners() {
                if (!this.db) return;
                
                console.log('üëÇ –ó–∞–ø—É—Å–∫ —Å–ª—É—à–∞—Ç–µ–ª–µ–π Firebase...');
                
                // –û—Å–Ω–æ–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
                this.db.ref('data/current').on('value', (snapshot) => {
                    const data = snapshot.val();
                    if (data) {
                        console.log('üì• –î–∞–Ω–Ω—ã–µ –ø–æ–ª—É—á–µ–Ω—ã:', data);
                        this.updateData(data);
                        this.lastUpdateTime = Date.now();
                        this.updateStatus('connected');
                    } else {
                        console.log('üì≠ –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –≤ Firebase');
                        this.showNoDataMessage();
                    }
                }, (error) => {
                    console.error('‚ùå –û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö:', error);
                    this.updateStatus('error');
                });
                
                // –°–∏—Å—Ç–µ–º–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
                this.db.ref('system/info').on('value', (snapshot) => {
                    const info = snapshot.val();
                    if (info) {
                        this.updateSystemInfo(info);
                    }
                });
                
                // –°—Ç–∞—Ç—É—Å Arduino
                this.db.ref('system/arduinoAlive').on('value', (snapshot) => {
                    const status = snapshot.val();
                    this.updateArduinoStatus(status);
                });
                
                // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
                this.db.ref('stats').on('value', (snapshot) => {
                    const stats = snapshot.val();
                    if (stats) {
                        this.updateStats(stats);
                    }
                });
                
                // –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Firebase
                this.db.ref('.info/connected').on('value', (snap) => {
                    this.isConnected = snap.val() === true;
                    this.updateFirebaseStatus(this.isConnected);
                });
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏ –æ—à–∏–±–æ–∫
                this.db.ref('errors').limitToLast(5).on('value', (snapshot) => {
                    const errors = snapshot.val();
                    if (errors) {
                        this.updateErrorList(errors);
                    }
                });
            }
            
            updateData(data) {
                // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ
                this.data.moisture = data.moisture || 0;
                this.data.pump = data.pump || 0;
                this.data.light = data.light || 0;
                this.data.timestamp = data.timestamp || 0;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º UI
                this.updateUI();
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –≥—Ä–∞—Ñ–∏–∫
                this.updateChart();
            }
            
            updateUI() {
                // –í–ª–∞–∂–Ω–æ—Å—Ç—å
                const moistureValue = document.getElementById('moistureValue');
                const moistureTrend = document.getElementById('moistureTrend');
                
                moistureValue.textContent = `${this.data.moisture}%`;
                
                // –¢—Ä–µ–Ω–¥ –≤–ª–∞–∂–Ω–æ—Å—Ç–∏
                if (this.chartData.length > 1) {
                    const current = this.data.moisture;
                    const prev = this.chartData[this.chartData.length - 2] || current;
                    const trendElement = document.getElementById('trendValue');
                    
                    if (current > prev + 2) {
                        moistureTrend.textContent = '‚Üó –†–∞—Å—Ç–µ—Ç';
                        moistureTrend.style.color = '#10b981';
                        trendElement.textContent = '‚Üó';
                        trendElement.style.color = '#10b981';
                    } else if (current < prev - 2) {
                        moistureTrend.textContent = '‚Üò –ü–∞–¥–∞–µ—Ç';
                        moistureTrend.style.color = '#ef4444';
                        trendElement.textContent = '‚Üò';
                        trendElement.style.color = '#ef4444';
                    } else {
                        moistureTrend.textContent = '‚Üí –°—Ç–∞–±–∏–ª—å–Ω–æ';
                        moistureTrend.style.color = '#f59e0b';
                        trendElement.textContent = '‚Üí';
                        trendElement.style.color = '#f59e0b';
                    }
                }
                
                // –°–≤–µ—Ç
                const lightElement = document.getElementById('lightStatus');
                const lightBtn = document.getElementById('toggleLightBtn');
                const lightBtnText = document.getElementById('lightBtnText');
                
                if (this.data.light) {
                    lightElement.textContent = '–í–ö–õ';
                    lightElement.style.color = '#f59e0b';
                    lightBtn.classList.add('active');
                    lightBtnText.textContent = '–í—ã–∫–ª—é—á–∏—Ç—å —Å–≤–µ—Ç';
                } else {
                    lightElement.textContent = '–í–´–ö–õ';
                    lightElement.style.color = '#94a3b8';
                    lightBtn.classList.remove('active');
                    lightBtnText.textContent = '–í–∫–ª—é—á–∏—Ç—å —Å–≤–µ—Ç';
                }
                
                // –ù–∞—Å–æ—Å
                const pumpElement = document.getElementById('pumpStatus');
                const pumpBtn = document.getElementById('togglePumpBtn');
                const pumpBtnText = document.getElementById('pumpBtnText');
                
                if (this.data.pump) {
                    pumpElement.textContent = '–í–ö–õ';
                    pumpElement.style.color = '#10b981';
                    pumpBtn.classList.add('active');
                    pumpBtnText.textContent = '–í—ã–∫–ª—é—á–∏—Ç—å –Ω–∞—Å–æ—Å';
                } else {
                    pumpElement.textContent = '–í–´–ö–õ';
                    pumpElement.style.color = '#94a3b8';
                    pumpBtn.classList.remove('active');
                    pumpBtnText.textContent = '–í–∫–ª—é—á–∏—Ç—å –Ω–∞—Å–æ—Å';
                }
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
                if (this.data.timestamp > 0) {
                    const date = new Date(this.data.timestamp * 1000);
                    const timeString = date.toLocaleTimeString('ru-RU');
                    document.getElementById('lastUpdate').textContent = `–û–±–Ω–æ–≤–ª–µ–Ω–æ: ${timeString}`;
                }
            }
            
            updateChart() {
                if (!this.chart) return;
                
                // –î–æ–±–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –≤ –∏—Å—Ç–æ—Ä–∏—é
                this.chartData.push(this.data.moisture);
                if (this.chartData.length > 24) {
                    this.chartData.shift();
                }
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –≥—Ä–∞—Ñ–∏–∫
                this.chart.data.datasets[0].data = [...this.chartData];
                this.chart.update('none');
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                this.updateChartStats();
            }
            
            updateChartStats() {
                if (this.chartData.length === 0) return;
                
                const validData = this.chartData.filter(v => v !== null);
                if (validData.length === 0) return;
                
                const sum = validData.reduce((a, b) => a + b, 0);
                const avg = Math.round(sum / validData.length);
                const min = Math.min(...validData);
                const max = Math.max(...validData);
                
                document.getElementById('avgMoisture').textContent = `${avg}%`;
                document.getElementById('minMoisture').textContent = `${min}%`;
                document.getElementById('maxMoisture').textContent = `${max}%`;
            }
            
            updateSystemInfo(info) {
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã
                let statusHtml = '';
                
                // Arduino —Å—Ç–∞—Ç—É—Å
                statusHtml += `
                    <div class="status-item" id="arduinoStatusItem">
                        <div>
                            <i class="fas fa-microchip"></i>
                            <span>Arduino UNO</span>
                        </div>
                        <span class="status-badge" id="arduinoStatus">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                    </div>
                `;
                
                // WiFi —Å—Ç–∞—Ç—É—Å
                if (info.wifiRssi) {
                    const signal = Math.abs(info.wifiRssi);
                    const wifiStatus = signal < 70 ? '–û—Ç–ª–∏—á–Ω—ã–π' : signal < 80 ? '–•–æ—Ä–æ—à–∏–π' : '–°–ª–∞–±—ã–π';
                    const wifiColor = signal < 70 ? '#10b981' : signal < 80 ? '#f59e0b' : '#ef4444';
                    
                    statusHtml += `
                        <div class="status-item">
                            <div>
                                <i class="fas fa-wifi"></i>
                                <span>WiFi –º–æ–¥—É–ª—å</span>
                            </div>
                            <span class="status-badge" style="color: ${wifiColor};">${wifiStatus}</span>
                        </div>
                    `;
                    
                    // IP –∞–¥—Ä–µ—Å
                    statusHtml += `
                        <div class="status-item">
                            <div>
                                <i class="fas fa-network-wired"></i>
                                <span>IP –∞–¥—Ä–µ—Å</span>
                            </div>
                            <span class="status-badge">${info.ip || '--'}</span>
                        </div>
                    `;
                }
                
                // –î–∞—Ç—á–∏–∫ –≤–ª–∞–∂–Ω–æ—Å—Ç–∏
                statusHtml += `
                    <div class="status-item">
                        <div>
                            <i class="fas fa-tachometer-alt"></i>
                            <span>–î–∞—Ç—á–∏–∫ –≤–ª–∞–∂–Ω–æ—Å—Ç–∏</span>
                        </div>
                        <span class="status-badge" id="sensorStatus">–†–∞–±–æ—Ç–∞–µ—Ç</span>
                    </div>
                `;
                
                document.getElementById('statusContainer').innerHTML = statusHtml;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Ä–µ–º—è —Å–µ—Ä–≤–µ—Ä–∞ –∏ –∞–ø—Ç–∞–π–º
                if (info.time) {
                    document.getElementById('serverTime').textContent = info.time;
                }
                
                if (info.uptime) {
                    const days = Math.floor(info.uptime / 86400);
                    const hours = Math.floor((info.uptime % 86400) / 3600);
                    const minutes = Math.floor((info.uptime % 3600) / 60);
                    document.getElementById('uptime').textContent = `${days}–¥ ${hours}—á ${minutes}–º`;
                }
            }
            
            updateArduinoStatus(status) {
                const arduinoElement = document.getElementById('arduinoStatus');
                const arduinoItem = document.getElementById('arduinoStatusItem');
                
                if (arduinoElement && arduinoItem) {
                    if (status === 1) {
                        arduinoElement.textContent = '–û–Ω–ª–∞–π–Ω';
                        arduinoElement.style.color = '#10b981';
                        arduinoItem.classList.add('online');
                    } else {
                        arduinoElement.textContent = '–û—Ñ–ª–∞–π–Ω';
                        arduinoElement.style.color = '#ef4444';
                        arduinoItem.classList.add('error');
                    }
                }
            }
            
            updateFirebaseStatus(isConnected) {
                const statusDot = document.getElementById('statusDot');
                const statusText = document.getElementById('statusText');
                
                if (isConnected) {
                    statusDot.classList.add('status-connected');
                    statusDot.classList.remove('status-disconnected');
                    statusDot.style.background = '#10b981';
                    statusText.textContent = '–ü–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ Firebase';
                } else {
                    statusDot.classList.add('status-disconnected');
                    statusDot.classList.remove('status-connected');
                    statusDot.style.background = '#ef4444';
                    statusText.textContent = '–û—Ç–∫–ª—é—á–µ–Ω–æ –æ—Ç Firebase';
                }
            }
            
            updateStatus(status) {
                const statusDot = document.getElementById('statusDot');
                const statusText = document.getElementById('statusText');
                
                switch(status) {
                    case 'connected':
                        statusDot.style.background = '#10b981';
                        statusText.textContent = '–î–∞–Ω–Ω—ã–µ –ø–æ–ª—É—á–µ–Ω—ã';
                        break;
                    case 'disconnected':
                        statusDot.style.background = '#ef4444';
                        statusText.textContent = '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö';
                        break;
                    case 'error':
                        statusDot.style.background = '#f59e0b';
                        statusText.textContent = '–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è';
                        break;
                }
            }
            
            updateStats(stats) {
                // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
                console.log('–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:', stats);
            }
            
            updateErrorList(errors) {
                const errorList = document.getElementById('errorList');
                if (!errors || Object.keys(errors).length === 0) {
                    errorList.innerHTML = `
                        <div class="no-data">
                            <i class="fas fa-check-circle"></i>
                            <p>–û—à–∏–±–æ–∫ –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ</p>
                        </div>
                    `;
                    return;
                }
                
                let errorsHtml = '';
                Object.keys(errors).forEach(key => {
                    const error = errors[key];
                    const time = new Date(error.timestamp || Date.now()).toLocaleTimeString('ru-RU');
                    
                    errorsHtml += `
                        <div class="error-item">
                            <div>${error.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}</div>
                            <div class="error-time">${time}</div>
                        </div>
                    `;
                });
                
                errorList.innerHTML = errorsHtml;
            }
            
            showNoDataMessage() {
                this.updateStatus('disconnected');
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –≥—Ä–∞—Ñ–∏–∫–µ
                if (this.chart) {
                    this.chart.data.datasets[0].data = Array(24).fill(null);
                    this.chart.update();
                }
                
                document.getElementById('moistureValue').textContent = '--%';
                document.getElementById('avgMoisture').textContent = '--%';
                document.getElementById('minMoisture').textContent = '--%';
                document.getElementById('maxMoisture').textContent = '--%';
                document.getElementById('trendValue').textContent = '‚Üí';
            }
            
            setupEventListeners() {
                // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–≤–µ—Ç–æ–º
                document.getElementById('toggleLightBtn').addEventListener('click', () => {
                    this.sendCommand('light', this.data.light ? 'OFF' : 'ON');
                });
                
                // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞—Å–æ—Å–æ–º
                document.getElementById('togglePumpBtn').addEventListener('click', () => {
                    this.sendCommand('pump', this.data.pump ? 'OFF' : 'ON');
                });
                
                // –ü–æ—Ä–æ–≥ –≤–ª–∞–∂–Ω–æ—Å—Ç–∏
                document.getElementById('moistureThreshold').addEventListener('input', (e) => {
                    document.getElementById('thresholdValue').textContent = e.target.value + '%';
                });
                
                document.getElementById('moistureThreshold').addEventListener('change', (e) => {
                    this.sendCommand('threshold', e.target.value);
                });
                
                // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–∂–∏–º
                document.getElementById('autoWateringToggle').addEventListener('change', (e) => {
                    this.sendCommand('autoWatering', e.target.checked ? 'ON' : 'OFF');
                });
                
                // –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø–æ–ª–∏–≤–∞
                document.getElementById('pumpDuration').addEventListener('change', (e) => {
                    this.sendCommand('pumpDuration', e.target.value);
                });
                
                // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –≤—Ä–µ–º–µ–Ω–∏
                document.getElementById('syncTimeBtn').addEventListener('click', () => {
                    this.syncTime();
                });
                
                // –û—á–∏—Å—Ç–∫–∞ –æ—à–∏–±–æ–∫
                document.getElementById('clearErrorsBtn').addEventListener('click', () => {
                    this.clearErrors();
                });
            }
            
            async sendCommand(type, value) {
                if (!this.db) {
                    this.showToast('‚ùå –ù–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Firebase', 'error');
                    return;
                }
                
                try {
                    await this.db.ref(`commands/${type}`).set(value);
                    console.log(`‚úÖ –ö–æ–º–∞–Ω–¥–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞: ${type}=${value}`);
                    this.showToast(`–ö–æ–º–∞–Ω–¥–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞: ${type}=${value}`, 'success');
                } catch (error) {
                    console.error('‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∫–æ–º–∞–Ω–¥—ã:', error);
                    this.showToast('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∫–æ–º–∞–Ω–¥—ã', 'error');
                }
            }
            
            quickWater(seconds) {
                if (!this.db) {
                    this.showToast('‚ùå –ù–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Firebase', 'error');
                    return;
                }
                
                try {
                    // –í–∫–ª—é—á–∞–µ–º –Ω–∞—Å–æ—Å
                    this.db.ref('commands/pump').set('ON');
                    this.showToast(`‚è±Ô∏è –ü–æ–ª–∏–≤ –Ω–∞ ${seconds} —Å–µ–∫—É–Ω–¥`, 'info');
                    
                    // –í—ã–∫–ª—é—á–∞–µ–º —á–µ—Ä–µ–∑ —É–∫–∞–∑–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è
                    setTimeout(() => {
                        if (this.db) {
                            this.db.ref('commands/pump').set('OFF');
                            this.showToast('‚úÖ –ü–æ–ª–∏–≤ –∑–∞–≤–µ—Ä—à–µ–Ω', 'success');
                        }
                    }, seconds * 1000);
                } catch (error) {
                    console.error('‚ùå –û—à–∏–±–∫–∞ –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–ª–∏–≤–∞:', error);
                    this.showToast('–û—à–∏–±–∫–∞ –ø–æ–ª–∏–≤–∞', 'error');
                }
            }
            
            async syncTime() {
                try {
                    const now = new Date();
                    const timeString = `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;
                    
                    await this.sendCommand('setTime', timeString);
                    this.showToast('–í—Ä–µ–º—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–æ', 'success');
                    
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –≤—Ä–µ–º–µ–Ω–∏:', error);
                    this.showToast('–û—à–∏–±–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –≤—Ä–µ–º–µ–Ω–∏', 'error');
                }
            }
            
            clearErrors() {
                if (!this.db) {
                    this.showToast('‚ùå –ù–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Firebase', 'error');
                    return;
                }
                
                try {
                    this.db.ref('errors').remove();
                    this.showToast('–ò—Å—Ç–æ—Ä–∏—è –æ—à–∏–±–æ–∫ –æ—á–∏—â–µ–Ω–∞', 'success');
                } catch (error) {
                    console.error('‚ùå –û—à–∏–±–∫–∞ –æ—á–∏—Å—Ç–∫–∏ –æ—à–∏–±–æ–∫:', error);
                    this.showToast('–û—à–∏–±–∫–∞ –æ—á–∏—Å—Ç–∫–∏ –æ—à–∏–±–æ–∫', 'error');
                }
            }
            
            startTimers() {
                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É
                setInterval(() => {
                    const now = new Date();
                    const timeString = now.toLocaleTimeString('ru-RU');
                    document.getElementById('currentTime').textContent = timeString;
                }, 1000);
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
                setInterval(() => {
                    if (this.lastUpdateTime > 0 && Date.now() - this.lastUpdateTime > 60000) {
                        this.updateStatus('disconnected');
                        this.showToast('‚ö†Ô∏è –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –±–æ–ª–µ–µ 1 –º–∏–Ω—É—Ç—ã', 'warning');
                    }
                }, 30000);
            }
            
            startLocalMode() {
                console.log('üîÑ –†–µ–∂–∏–º –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è');
                this.showToast('‚ö†Ô∏è –†–∞–±–æ—Ç–∞ –≤ –ª–æ–∫–∞–ª—å–Ω–æ–º —Ä–µ–∂–∏–º–µ', 'warning');
                
                // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
                setInterval(() => {
                    this.data.moisture = Math.max(20, Math.min(80, this.data.moisture + (Math.random() - 0.5) * 3));
                    this.data.light = Math.random() > 0.7 ? 1 : 0;
                    this.data.pump = Math.random() > 0.9 ? 1 : 0;
                    
                    this.updateUI();
                    this.updateChart();
                }, 3000);
            }
            
            showToast(message, type = 'info') {
                const container = document.getElementById('toastContainer');
                if (!container) return;
                
                const toast = document.createElement('div');
                toast.className = `toast ${type}`;
                
                let icon = 'fas fa-info-circle';
                if (type === 'success') icon = 'fas fa-check-circle';
                if (type === 'error') icon = 'fas fa-exclamation-circle';
                if (type === 'warning') icon = 'fas fa-exclamation-triangle';
                
                toast.innerHTML = `<i class="${icon}"></i> ${message}`;
                
                container.appendChild(toast);
                
                // –£–¥–∞–ª—è–µ–º —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
                setTimeout(() => {
                    toast.style.animation = 'slideOut 0.3s ease forwards';
                    setTimeout(() => toast.remove(), 300);
                }, 5000);
            }
        }
        
        // –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∫–æ–≥–¥–∞ –≤—Å–µ –∑–∞–≥—Ä—É–∑–∏—Ç—Å—è
        window.addEventListener('load', () => {
            console.log('üìÑ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
            setTimeout(() => {
                window.app = new EcoGrowApp();
            }, 500);
        });
        
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–ª–∏–≤–∞
        window.quickWater = function(seconds) {
            if (window.app) {
                window.app.quickWater(seconds);
            }
        };
    </script>
</body>
</html>
