<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üå± EcoGrow Control</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Arial, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        
        .header {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            margin-bottom: 10px;
            font-size: 2rem;
        }
        
        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .device-list {
            display: grid;
            gap: 15px;
        }
        
        .device-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            border-left: 5px solid #27ae60;
            cursor: pointer;
            transition: transform 0.3s;
        }
        
        .device-item:hover {
            transform: translateY(-5px);
            background: #e9ecef;
        }
        
        .device-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .device-name {
            font-weight: bold;
            color: #2c3e50;
            font-size: 1.1rem;
        }
        
        .device-status {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
        }
        
        .status-online {
            background: rgba(39, 174, 96, 0.2);
            color: #27ae60;
        }
        
        .status-offline {
            background: rgba(231, 76, 60, 0.2);
            color: #e74c3c;
        }
        
        .device-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .info-item {
            background: white;
            padding: 8px;
            border-radius: 8px;
            text-align: center;
        }
        
        .info-label {
            font-size: 0.8rem;
            color: #7f8c8d;
            margin-bottom: 3px;
        }
        
        .info-value {
            font-size: 1.2rem;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .moisture-value {
            font-size: 2.5rem;
            font-weight: bold;
            text-align: center;
            color: #3498db;
            margin: 10px 0;
        }
        
        .controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        
        .btn {
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: #3498db;
            color: white;
        }
        
        .btn-primary:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }
        
        .btn-success {
            background: #27ae60;
            color: white;
        }
        
        .btn-success:hover {
            background: #229954;
            transform: translateY(-2px);
        }
        
        .btn-danger {
            background: #e74c3c;
            color: white;
        }
        
        .btn-danger:hover {
            background: #c0392b;
            transform: translateY(-2px);
        }
        
        .settings {
            margin-top: 20px;
        }
        
        .setting-item {
            margin-bottom: 15px;
        }
        
        .setting-label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .slider-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        input[type="range"] {
            flex: 1;
            height: 8px;
            border-radius: 4px;
            background: #f1f2f6;
            outline: none;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            transform: translateX(120%);
            transition: transform 0.3s;
            border-left: 5px solid #27ae60;
            z-index: 1000;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .loading {
            text-align: center;
            padding: 20px;
            color: #7f8c8d;
        }
        
        @media (max-width: 600px) {
            .controls {
                grid-template-columns: 1fr;
            }
            
            .device-info {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üå± EcoGrow Remote Control</h1>
            <p>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º–æ–π –∞–≤—Ç–æ–ø–æ–ª–∏–≤–∞ –∏–∑ –ª—é–±–æ–π —Ç–æ—á–∫–∏ –º–∏—Ä–∞</p>
            <p id="connectionStatus" style="margin-top: 10px; font-size: 0.9rem;">üîå –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –æ–±–ª–∞–∫—É...</p>
        </div>
        
        <div class="card">
            <h2 style="margin-bottom: 15px;">üì± –î–æ—Å—Ç—É–ø–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞</h2>
            <div id="devicesContainer" class="device-list">
                <div class="loading">
                    <p>üîç –ü–æ–∏—Å–∫ —É—Å—Ç—Ä–æ–π—Å—Ç–≤...</p>
                </div>
            </div>
        </div>
        
        <div class="card" id="controlPanel" style="display: none;">
            <div class="device-header">
                <h2 id="selectedDeviceName">–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ: --</h2>
                <div id="selectedDeviceStatus" class="device-status status-offline">–û—Ñ—Ñ–ª–∞–π–Ω</div>
            </div>
            
            <div id="deviceDetails">
                <!-- –ó–¥–µ—Å—å –±—É–¥–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ -->
            </div>
            
            <div class="settings">
                <h3>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</h3>
                <div class="setting-item">
                    <label class="setting-label">–ü–æ—Ä–æ–≥ –≤–ª–∞–∂–Ω–æ—Å—Ç–∏: <span id="thresholdValue">50%</span></label>
                    <div class="slider-container">
                        <input type="range" id="moistureThreshold" min="10" max="90" value="50">
                    </div>
                </div>
                <button class="btn btn-success" onclick="saveSettings()" style="margin-top: 10px;">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</button>
            </div>
        </div>
    </div>
    
    <div id="notification" class="notification"></div>
    
    <!-- Firebase –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js"></script>
    <script>
        // ============================================
        // –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø FIREBASE - –ó–ê–ú–ï–ù–ò–¢–ï –≠–¢–ò –î–ê–ù–ù–´–ï!
        // ============================================
        const firebaseConfig = {
            apiKey: "AIzaSyB1234567890abcdefghijklmnopqrstuvwxyz",
            authDomain: "ecogrow-remote.firebaseapp.com",
            databaseURL: "https://ecogrow-remote-default-rtdb.firebaseio.com",
            projectId: "ecogrow-remote",
            storageBucket: "ecogrow-remote.appspot.com",
            messagingSenderId: "123456789012",
            appId: "1:123456789012:web:abcdef1234567890abcdef"
        };
        // ============================================
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        
        let currentDeviceId = null;
        
        // –§—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤
        function loadDevices() {
            const devicesRef = database.ref('devices');
            
            // –°–ª—É—à–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
            devicesRef.on('value', (snapshot) => {
                const devices = snapshot.val();
                const container = document.getElementById('devicesContainer');
                
                if (!devices) {
                    container.innerHTML = '<div class="loading"><p>‚ö†Ô∏è –£—Å—Ç—Ä–æ–π—Å—Ç–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</p></div>';
                    return;
                }
                
                let html = '';
                
                // –ü–µ—Ä–µ–±–∏—Ä–∞–µ–º –≤—Å–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
                for (const deviceId in devices) {
                    const device = devices[deviceId];
                    const isOnline = checkIfOnline(device);
                    
                    html += `
                        <div class="device-item" onclick="selectDevice('${deviceId}')">
                            <div class="device-header">
                                <div class="device-name">${device.name || '–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ ' + deviceId}</div>
                                <div class="device-status ${isOnline ? 'status-online' : 'status-offline'}">
                                    ${isOnline ? 'üü¢ –û–Ω–ª–∞–π–Ω' : 'üî¥ –û—Ñ—Ñ–ª–∞–π–Ω'}
                                </div>
                            </div>
                            
                            ${isOnline ? `
                                <div class="device-info">
                                    <div class="info-item">
                                        <div class="info-label">–í–ª–∞–∂–Ω–æ—Å—Ç—å</div>
                                        <div class="info-value">${device.data?.moisture || '--'}%</div>
                                    </div>
                                    <div class="info-item">
                                        <div class="info-label">–ù–∞—Å–æ—Å</div>
                                        <div class="info-value">${device.data?.pump ? '–í–ö–õ' : '–í–´–ö–õ'}</div>
                                    </div>
                                </div>
                                
                                <div class="controls">
                                    <button class="btn ${device.data?.pump ? 'btn-danger' : 'btn-success'}" 
                                            onclick="event.stopPropagation(); togglePump('${deviceId}', ${!device.data?.pump})">
                                        ${device.data?.pump ? '‚õî –í—ã–∫–ª—é—á–∏—Ç—å –Ω–∞—Å–æ—Å' : 'üíß –í–∫–ª—é—á–∏—Ç—å –Ω–∞—Å–æ—Å'}
                                    </button>
                                    <button class="btn ${device.data?.light ? 'btn-danger' : 'btn-success'}" 
                                            onclick="event.stopPropagation(); toggleLight('${deviceId}', ${!device.data?.light})">
                                        ${device.data?.light ? 'üí° –í—ã–∫–ª—é—á–∏—Ç—å —Å–≤–µ—Ç' : 'üí° –í–∫–ª—é—á–∏—Ç—å —Å–≤–µ—Ç'}
                                    </button>
                                </div>
                            ` : '<p style="color: #e74c3c; text-align: center;">–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –Ω–µ –≤ —Å–µ—Ç–∏</p>'}
                        </div>
                    `;
                }
                
                container.innerHTML = html;
                document.getElementById('connectionStatus').innerHTML = '‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ –æ–±–ª–∞–∫—É';
            });
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–Ω–ª–∞–π–Ω-—Å—Ç–∞—Ç—É—Å–∞ (—Å—á–∏—Ç–∞–µ–º –æ–Ω–ª–∞–π–Ω –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –Ω–µ —Å—Ç–∞—Ä—à–µ 2 –º–∏–Ω—É—Ç)
        function checkIfOnline(device) {
            if (!device.data || !device.data.timestamp) return false;
            const now = Math.floor(Date.now() / 1000); // —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
            const deviceTime = device.data.timestamp;
            return (now - deviceTime) < 120; // 2 –º–∏–Ω—É—Ç—ã
        }
        
        // –í—ã–±–æ—Ä —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
        function selectDevice(deviceId) {
            currentDeviceId = deviceId;
            const deviceRef = database.ref('devices/' + deviceId);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
            document.getElementById('selectedDeviceName').textContent = 
                `–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ: ${deviceId}`;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
            document.getElementById('controlPanel').style.display = 'block';
            
            // –°–ª—É—à–∞–µ–º –¥–∞–Ω–Ω—ã–µ —ç—Ç–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
            deviceRef.on('value', (snapshot) => {
                const device = snapshot.val();
                if (!device) return;
                
                const isOnline = checkIfOnline(device);
                document.getElementById('selectedDeviceStatus').className = 
                    `device-status ${isOnline ? 'status-online' : 'status-offline'}`;
                document.getElementById('selectedDeviceStatus').textContent = 
                    isOnline ? 'üü¢ –û–Ω–ª–∞–π–Ω' : 'üî¥ –û—Ñ—Ñ–ª–∞–π–Ω';
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –¥–µ—Ç–∞–ª–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
                updateDeviceDetails(deviceId, device);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
                if (device.settings) {
                    document.getElementById('moistureThreshold').value = 
                        device.settings.moistureThreshold || 50;
                    document.getElementById('thresholdValue').textContent = 
                        (device.settings.moistureThreshold || 50) + '%';
                }
            });
            
            showNotification('‚úÖ –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –≤—ã–±—Ä–∞–Ω–æ');
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–µ—Ç–∞–ª–µ–π —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
        function updateDeviceDetails(deviceId, device) {
            const detailsDiv = document.getElementById('deviceDetails');
            
            if (!device.data) {
                detailsDiv.innerHTML = '<p>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ—Ç —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞</p>';
                return;
            }
            
            const isOnline = checkIfOnline(device);
            
            detailsDiv.innerHTML = `
                <div class="moisture-value">${device.data.moisture || '--'}%</div>
                <div class="device-info">
                    <div class="info-item">
                        <div class="info-label">–ù–∞—Å–æ—Å</div>
                        <div class="info-value">${device.data.pump ? 'üü¢ –í–ö–õ' : 'üî¥ –í–´–ö–õ'}</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">–°–≤–µ—Ç</div>
                        <div class="info-value">${device.data.light ? 'üü¢ –í–ö–õ' : 'üî¥ –í–´–ö–õ'}</div>
                    </div>
                </div>
                
                ${isOnline ? `
                    <div class="controls">
                        <button class="btn ${device.data.pump ? 'btn-danger' : 'btn-success'}" 
                                onclick="togglePump('${deviceId}', ${!device.data.pump})">
                            ${device.data.pump ? '‚õî –í—ã–∫–ª—é—á–∏—Ç—å –Ω–∞—Å–æ—Å' : 'üíß –í–∫–ª—é—á–∏—Ç—å –Ω–∞—Å–æ—Å'}
                        </button>
                        <button class="btn ${device.data.light ? 'btn-danger' : 'btn-success'}" 
                                onclick="toggleLight('${deviceId}', ${!device.data.light})">
                            ${device.data.light ? 'üí° –í—ã–∫–ª—é—á–∏—Ç—å —Å–≤–µ—Ç' : 'üí° –í–∫–ª—é—á–∏—Ç—å —Å–≤–µ—Ç'}
                        </button>
                    </div>
                ` : '<p style="text-align: center; color: #e74c3c;">–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –Ω–µ –≤ —Å–µ—Ç–∏, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ</p>'}
            `;
        }
        
        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞—Å–æ—Å–æ–º
        function togglePump(deviceId, state) {
            sendCommand(deviceId, 'pump', state ? 1 : 0);
            showNotification(state ? 'üíß –ù–∞—Å–æ—Å –≤–∫–ª—é—á–µ–Ω' : '‚õî –ù–∞—Å–æ—Å –≤—ã–∫–ª—é—á–µ–Ω');
        }
        
        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–≤–µ—Ç–æ–º
        function toggleLight(deviceId, state) {
            sendCommand(deviceId, 'light', state ? 1 : 0);
            showNotification(state ? 'üí° –°–≤–µ—Ç –≤–∫–ª—é—á–µ–Ω' : 'üåô –°–≤–µ—Ç –≤—ã–∫–ª—é—á–µ–Ω');
        }
        
        // –û—Ç–ø—Ä–∞–≤–∫–∞ –∫–æ–º–∞–Ω–¥—ã –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ
        function sendCommand(deviceId, command, value) {
            database.ref('devices/' + deviceId + '/commands/latest').set({
                command: command,
                value: value,
                timestamp: Date.now(),
                source: 'web'
            });
        }
        
        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫
        function saveSettings() {
            if (!currentDeviceId) {
                showNotification('‚ùå –°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ', true);
                return;
            }
            
            const threshold = document.getElementById('moistureThreshold').value;
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ—Ä–æ–≥ –≤–ª–∞–∂–Ω–æ—Å—Ç–∏ –∫–∞–∫ –∫–æ–º–∞–Ω–¥—É
            sendCommand(currentDeviceId, 'threshold', parseInt(threshold));
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ Firebase
            database.ref('devices/' + currentDeviceId + '/settings').update({
                moistureThreshold: parseInt(threshold),
                lastUpdated: Date.now()
            });
            
            showNotification('‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã');
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
        function showNotification(message, isError = false) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.style.borderLeftColor = isError ? '#e74c3c' : '#27ae60';
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }
        
        // –ó–∞–ø—É—Å–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.onload = function() {
            loadDevices();
            showNotification('üåê –ó–∞–≥—Ä—É–∑–∫–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤...');
            
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
            setInterval(loadDevices, 5000);
        };
    </script>
</body>
</html>
