<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EcoGrow Assistant</title>
    
    <!-- –í–†–ï–ú–ï–ù–ù–û –£–ë–ò–†–ê–ï–ú CSP –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ -->
    <!-- <meta http-equiv="Content-Security-Policy" content="..."> -->
    
    <!-- –ò–∫–æ–Ω–∫–∏ -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Firebase 8.10.1 (—Å–∞–º–∞—è —Å—Ç–∞–±–∏–ª—å–Ω–∞—è) -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    
    <style>
        /* –ë–ê–ó–û–í–´–ï –°–¢–ò–õ–ò –ø—Ä—è–º–æ –∑–¥–µ—Å—å */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; background: #0f172a; color: white; }
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
        
        /* Header */
        .header { background: #1e293b; padding: 15px 0; border-bottom: 2px solid #334155; }
        .header-content { display: flex; justify-content: space-between; align-items: center; }
        .logo { display: flex; align-items: center; gap: 10px; }
        .logo i { color: #10b981; font-size: 2rem; }
        .logo h1 { font-size: 1.5rem; }
        
        /* Cards */
        .stats-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin: 20px 0; }
        .stat-card { background: #1e293b; padding: 20px; border-radius: 10px; border-left: 4px solid #3b82f6; }
        .stat-value { font-size: 2rem; font-weight: bold; margin: 10px 0; }
        
        /* Main Layout */
        .main-layout { display: grid; grid-template-columns: 2fr 1fr; gap: 20px; }
        .chart-container { background: #1e293b; padding: 20px; border-radius: 10px; margin-bottom: 20px; }
        .chart-wrapper { height: 300px; }
        
        /* Controls */
        .controls { background: #1e293b; padding: 20px; border-radius: 10px; }
        .control-btn { background: #3b82f6; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin: 5px; }
        .control-btn.active { background: #10b981; }
        
        /* Status */
        .status-list { margin: 20px 0; }
        .status-item { display: flex; justify-content: space-between; padding: 10px; background: #334155; margin: 5px 0; border-radius: 5px; }
        .status-online { color: #10b981; }
        .status-offline { color: #ef4444; }
        
        /* Footer */
        .footer { margin-top: 30px; padding-top: 20px; border-top: 1px solid #334155; text-align: center; }
        
        /* Toast */
        .toast { position: fixed; bottom: 20px; right: 20px; background: #1e293b; padding: 15px; border-radius: 5px; border-left: 4px solid #3b82f6; }
    </style>
</head>
<body>
    <!-- Preloader -->
    <div id="preloader" style="position:fixed; top:0; left:0; width:100%; height:100%; background:#0f172a; display:flex; justify-content:center; align-items:center; z-index:9999;">
        <div style="text-align:center;">
            <div style="font-size:3rem; color:#10b981; margin-bottom:20px;"><i class="fas fa-seedling fa-spin"></i></div>
            <div>–ó–∞–≥—Ä—É–∑–∫–∞ EcoGrow...</div>
        </div>
    </div>

    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <i class="fas fa-seedling"></i>
                    <h1>EcoGrow Assistant</h1>
                </div>
                <div id="connectionStatus" style="display:flex; align-items:center; gap:10px;">
                    <div class="status-dot" style="width:10px; height:10px; background:gray; border-radius:50%;"></div>
                    <span>–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...</span>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container">
        <!-- Top Stats -->
        <div class="stats-grid">
            <div class="stat-card">
                <h3><i class="fas fa-tint"></i> –í–ª–∞–∂–Ω–æ—Å—Ç—å –ø–æ—á–≤—ã</h3>
                <div class="stat-value" id="moistureValue">--%</div>
                <div id="moistureTrend">‚Üó –°—Ç–∞–±–∏–ª—å–Ω–æ</div>
            </div>
            
            <div class="stat-card" style="border-left-color:#10b981;">
                <h3><i class="fas fa-temperature-high"></i> –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞</h3>
                <div class="stat-value" id="temperatureValue">--¬∞C</div>
                <div>–î–∞—Ç—á–∏–∫: <span id="tempSensorStatus">–ù–µ—Ç</span></div>
            </div>
            
            <div class="stat-card" style="border-left-color:#f59e0b;">
                <h3><i class="fas fa-sun"></i> –°–≤–µ—Ç</h3>
                <div class="stat-value" id="lightStatus">–í–´–ö–õ</div>
                <button class="control-btn" id="toggleLightBtn">–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å</button>
            </div>
            
            <div class="stat-card" style="border-left-color:#ef4444;">
                <h3><i class="fas fa-water"></i> –ù–∞—Å–æ—Å</h3>
                <div class="stat-value" id="pumpStatus">–í–´–ö–õ</div>
                <button class="control-btn" id="togglePumpBtn">–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å</button>
            </div>
        </div>

        <div class="main-layout">
            <!-- Left Column: Chart -->
            <div>
                <div class="chart-container">
                    <h2><i class="fas fa-chart-line"></i> –ì—Ä–∞—Ñ–∏–∫ –≤–ª–∞–∂–Ω–æ—Å—Ç–∏</h2>
                    <div class="chart-wrapper">
                        <canvas id="moistureChart"></canvas>
                    </div>
                </div>
                
                <div class="controls">
                    <h2><i class="fas fa-sliders-h"></i> –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</h2>
                    <div style="margin: 15px 0;">
                        <label>–ü–æ—Ä–æ–≥ –ø–æ–ª–∏–≤–∞: <span id="thresholdValue">50%</span></label>
                        <input type="range" id="moistureThreshold" min="10" max="90" value="50" style="width:100%;">
                    </div>
                    <div style="display:flex; gap:10px;">
                        <button class="control-btn" id="manualPumpBtn"><i class="fas fa-play"></i> –ü–æ–ª–∏–≤ 10—Å</button>
                        <button class="control-btn" id="autoToggleBtn" style="background:#10b981;"><i class="fas fa-robot"></i> –ê–≤—Ç–æ: –í–ö–õ</button>
                    </div>
                </div>
            </div>

            <!-- Right Column: Status -->
            <div>
                <div class="chart-container">
                    <h2><i class="fas fa-heartbeat"></i> –°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã</h2>
                    <div class="status-list">
                        <div class="status-item">
                            <span><i class="fas fa-microchip"></i> Arduino UNO</span>
                            <span id="arduinoStatus" class="status-offline">–û—Ñ–ª–∞–π–Ω</span>
                        </div>
                        <div class="status-item">
                            <span><i class="fas fa-wifi"></i> WiFi –º–æ–¥—É–ª—å</span>
                            <span id="wifiStatus">--</span>
                        </div>
                        <div class="status-item">
                            <span><i class="fas fa-tachometer-alt"></i> –î–∞—Ç—á–∏–∫ –≤–ª–∞–∂–Ω–æ—Å—Ç–∏</span>
                            <span id="sensorStatus" class="status-online">–û–Ω–ª–∞–π–Ω</span>
                        </div>
                        <div class="status-item">
                            <span><i class="fas fa-clock"></i> –ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ</span>
                            <span id="lastUpdate">--:--:--</span>
                        </div>
                    </div>
                    
                    <div style="margin-top:20px; padding:15px; background:#334155; border-radius:5px;">
                        <h4><i class="fas fa-info-circle"></i> –°–∏—Å—Ç–µ–º–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h4>
                        <div style="margin-top:10px;">
                            <div>IP –∞–¥—Ä–µ—Å: <span id="systemIp">--</span></div>
                            <div>–°–∏–≥–Ω–∞–ª WiFi: <span id="wifiSignal">--</span></div>
                            <div>–ê–ø—Ç–∞–π–º: <span id="uptime">--</span></div>
                        </div>
                    </div>
                </div>
                
                <div class="chart-container">
                    <h2><i class="fas fa-history"></i> –ò—Å—Ç–æ—Ä–∏—è –æ—à–∏–±–æ–∫</h2>
                    <div id="errorList">
                        <div style="padding:10px; background:#334155; margin:5px 0; border-radius:5px;">
                            <div style="color:#f59e0b;"><i class="fas fa-exclamation-triangle"></i> –¢–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ</div>
                            <div style="font-size:0.9em; color:#94a3b8;">–°–µ–≥–æ–¥–Ω—è 12:00</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer class="footer container">
        <p>EcoGrow Assistant v4.5 | –†–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–æ –ö—É–ø—á–µ–Ω—è –ï–≤–≥–µ–Ω–∏–µ–º</p>
        <p style="color:#94a3b8; margin-top:5px;">–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–æ–ª–∏–≤–∞ —Ä–∞—Å—Ç–µ–Ω–∏–π</p>
    </footer>

    <!-- Toast Container -->
    <div id="toastContainer" style="position:fixed; bottom:20px; right:20px; z-index:1000;"></div>

    <!-- Firebase Initialization -->
    <script>
        // –ü—Ä–æ—Å—Ç–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyBsZr7vWJDFt_S5i0Rvj6ejp6QT0JX9SPk",
            authDomain: "ecogrow-remote.firebaseapp.com",
            databaseURL: "https://ecogrow-remote-default-rtdb.firebaseio.com",
            projectId: "ecogrow-remote",
            storageBucket: "ecogrow-remote.firebasestorage.app",
            messagingSenderId: "121689275158",
            appId: "1:121689275158:web:f3b1829755c8b8a1fb2e37",
            measurementId: "G-PG5116NH38"
        };
        
        console.log('üî• –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase...');
        
        try {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∑–∞–≥—Ä—É–∂–µ–Ω –ª–∏ Firebase
            if (typeof firebase === 'undefined') {
                console.error('‚ùå Firebase SDK –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω!');
                throw new Error('Firebase SDK –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω');
            }
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º Firebase
            firebase.initializeApp(firebaseConfig);
            const database = firebase.database();
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –≥–ª–æ–±–∞–ª—å–Ω—É—é –æ–±–ª–∞—Å—Ç—å
            window.firebaseDatabase = database;
            
            console.log('‚úÖ Firebase –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
            
            // –¢–µ—Å—Ç–∏—Ä—É–µ–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
            database.ref('.info/connected').on('value', (snap) => {
                console.log('üì° Firebase –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ:', snap.val() ? '‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–æ' : '‚ùå –û—Ç–∫–ª—é—á–µ–Ω–æ');
            });
            
        } catch (error) {
            console.error('‚ùå –û—à–∏–±–∫–∞ Firebase:', error);
            window.firebaseDatabase = null;
        }
    </script>
    
    <!-- Main App -->
    <script>
        class EcoGrowApp {
            constructor() {
                this.db = window.firebaseDatabase;
                this.data = {
                    moisture: 0,
                    pump: 0,
                    light: 0,
                    temperature: null,
                    humidity: null
                };
                this.chart = null;
                this.chartData = [];
                
                console.log('üöÄ –ó–∞–ø—É—Å–∫ EcoGrow Assistant...');
                
                // –°—Ä–∞–∑—É –∑–∞–ø—É—Å–∫–∞–µ–º
                this.init();
            }
            
            init() {
                // –°–∫—Ä—ã–≤–∞–µ–º –ø—Ä–µ–ª–æ–∞–¥–µ—Ä
                setTimeout(() => {
                    document.getElementById('preloader').style.display = 'none';
                }, 1000);
                
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –≥—Ä–∞—Ñ–∏–∫
                this.initChart();
                
                // –ó–∞–ø—É—Å–∫–∞–µ–º —Å–ª—É—à–∞—Ç–µ–ª–∏ Firebase
                if (this.db) {
                    this.startFirebaseListeners();
                    this.updateStatus('–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Firebase...', 'warning');
                } else {
                    this.updateStatus('Firebase –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω', 'error');
                    this.startLocalMode();
                }
                
                // –ù–∞–∑–Ω–∞—á–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
                this.setupEventListeners();
                
                // –ó–∞–ø—É—Å–∫–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏
                this.startTimers();
            }
            
            initChart() {
                const ctx = document.getElementById('moistureChart').getContext('2d');
                
                // –£–Ω–∏—á—Ç–æ–∂–∞–µ–º —Å—Ç–∞—Ä—ã–π –≥—Ä–∞—Ñ–∏–∫ –µ—Å–ª–∏ –µ—Å—Ç—å
                if (this.chart) {
                    this.chart.destroy();
                }
                
                this.chart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: Array.from({length: 24}, (_, i) => {
                            const hour = (new Date().getHours() - (23 - i) + 24) % 24;
                            return hour.toString().padStart(2, '0') + ':00';
                        }),
                        datasets: [{
                            label: '–í–ª–∞–∂–Ω–æ—Å—Ç—å %',
                            data: Array(24).fill(null),
                            borderColor: '#3b82f6',
                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                            borderWidth: 2,
                            fill: true,
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { display: false } },
                        scales: {
                            x: { grid: { color: 'rgba(255,255,255,0.1)' }, ticks: { color: '#94a3b8' } },
                            y: { 
                                min: 0, max: 100,
                                grid: { color: 'rgba(255,255,255,0.1)' }, 
                                ticks: { color: '#94a3b8', callback: v => v + '%' }
                            }
                        }
                    }
                });
            }
            
            startFirebaseListeners() {
                if (!this.db) return;
                
                console.log('üëÇ –ó–∞–ø—É—Å–∫ —Å–ª—É—à–∞—Ç–µ–ª–µ–π Firebase...');
                
                // –û—Å–Ω–æ–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
                this.db.ref('data/current').on('value', (snapshot) => {
                    const data = snapshot.val();
                    if (data) {
                        console.log('üì• –î–∞–Ω–Ω—ã–µ –ø–æ–ª—É—á–µ–Ω—ã:', data);
                        this.updateData(data);
                    } else {
                        console.log('üì≠ –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –≤ Firebase');
                    }
                });
                
                // –°–∏—Å—Ç–µ–º–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
                this.db.ref('system/info').on('value', (snapshot) => {
                    const info = snapshot.val();
                    if (info) {
                        this.updateSystemInfo(info);
                    }
                });
                
                // –°—Ç–∞—Ç—É—Å Arduino
                this.db.ref('system/arduinoAlive').on('value', (snapshot) => {
                    const status = snapshot.val();
                    this.updateArduinoStatus(status);
                });
                
                // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
                this.db.ref('stats').on('value', (snapshot) => {
                    const stats = snapshot.val();
                    if (stats) {
                        this.updateStats(stats);
                    }
                });
                
                // –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Firebase
                this.db.ref('.info/connected').on('value', (snap) => {
                    const isConnected = snap.val() === true;
                    this.updateFirebaseStatus(isConnected);
                });
            }
            
            updateData(data) {
                // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ
                this.data.moisture = data.moisture || 0;
                this.data.pump = data.pump || 0;
                this.data.light = data.light || 0;
                this.data.temperature = data.temperature || null;
                this.data.humidity = data.humidity || null;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º UI
                this.updateUI();
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –≥—Ä–∞—Ñ–∏–∫
                this.updateChart();
            }
            
            updateUI() {
                // –í–ª–∞–∂–Ω–æ—Å—Ç—å
                document.getElementById('moistureValue').textContent = `${this.data.moisture}%`;
                
                // –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ (–µ—Å–ª–∏ –µ—Å—Ç—å –¥–∞—Ç—á–∏–∫)
                const tempElement = document.getElementById('temperatureValue');
                const tempSensorElement = document.getElementById('tempSensorStatus');
                if (this.data.temperature !== null && this.data.temperature !== 0) {
                    tempElement.textContent = `${this.data.temperature}¬∞C`;
                    tempSensorElement.textContent = '–ï—Å—Ç—å';
                    tempSensorElement.style.color = '#10b981';
                } else {
                    tempElement.textContent = '--¬∞C';
                    tempSensorElement.textContent = '–ù–µ—Ç';
                    tempSensorElement.style.color = '#ef4444';
                }
                
                // –°–≤–µ—Ç
                const lightElement = document.getElementById('lightStatus');
                const lightBtn = document.getElementById('toggleLightBtn');
                if (this.data.light) {
                    lightElement.textContent = '–í–ö–õ';
                    lightElement.style.color = '#f59e0b';
                    lightBtn.innerHTML = '<i class="fas fa-toggle-on"></i> –í—ã–∫–ª—é—á–∏—Ç—å';
                    lightBtn.style.background = '#f59e0b';
                } else {
                    lightElement.textContent = '–í–´–ö–õ';
                    lightElement.style.color = '#94a3b8';
                    lightBtn.innerHTML = '<i class="fas fa-toggle-off"></i> –í–∫–ª—é—á–∏—Ç—å';
                    lightBtn.style.background = '#3b82f6';
                }
                
                // –ù–∞—Å–æ—Å
                const pumpElement = document.getElementById('pumpStatus');
                const pumpBtn = document.getElementById('togglePumpBtn');
                if (this.data.pump) {
                    pumpElement.textContent = '–í–ö–õ';
                    pumpElement.style.color = '#ef4444';
                    pumpBtn.innerHTML = '<i class="fas fa-toggle-on"></i> –í—ã–∫–ª—é—á–∏—Ç—å';
                    pumpBtn.style.background = '#ef4444';
                } else {
                    pumpElement.textContent = '–í–´–ö–õ';
                    pumpElement.style.color = '#94a3b8';
                    pumpBtn.innerHTML = '<i class="fas fa-toggle-off"></i> –í–∫–ª—é—á–∏—Ç—å';
                    pumpBtn.style.background = '#3b82f6';
                }
                
                // –¢—Ä–µ–Ω–¥ –≤–ª–∞–∂–Ω–æ—Å—Ç–∏
                if (this.chartData.length > 1) {
                    const current = this.data.moisture;
                    const prev = this.chartData[this.chartData.length - 2] || current;
                    const trendElement = document.getElementById('moistureTrend');
                    
                    if (current > prev) {
                        trendElement.textContent = '‚Üó –†–∞—Å—Ç–µ—Ç';
                        trendElement.style.color = '#10b981';
                    } else if (current < prev) {
                        trendElement.textContent = '‚Üò –ü–∞–¥–∞–µ—Ç';
                        trendElement.style.color = '#ef4444';
                    } else {
                        trendElement.textContent = '‚Üí –°—Ç–∞–±–∏–ª—å–Ω–æ';
                        trendElement.style.color = '#f59e0b';
                    }
                }
            }
            
            updateChart() {
                if (!this.chart) return;
                
                // –î–æ–±–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –≤ –∏—Å—Ç–æ—Ä–∏—é
                this.chartData.push(this.data.moisture);
                if (this.chartData.length > 24) {
                    this.chartData.shift();
                }
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –≥—Ä–∞—Ñ–∏–∫
                this.chart.data.datasets[0].data = [...this.chartData];
                this.chart.update();
            }
            
            updateSystemInfo(info) {
                // WiFi —Å—Ç–∞—Ç—É—Å
                const wifiElement = document.getElementById('wifiStatus');
                if (info.wifiRssi) {
                    const signal = Math.abs(info.wifiRssi);
                    wifiElement.textContent = signal < 70 ? '–û—Ç–ª–∏—á–Ω—ã–π' : signal < 80 ? '–•–æ—Ä–æ—à–∏–π' : '–°–ª–∞–±—ã–π';
                    wifiElement.style.color = signal < 70 ? '#10b981' : signal < 80 ? '#f59e0b' : '#ef4444';
                    
                    // –°–∏–≥–Ω–∞–ª WiFi
                    document.getElementById('wifiSignal').textContent = `${info.wifiRssi} dBm`;
                }
                
                // IP –∞–¥—Ä–µ—Å
                if (info.ip) {
                    document.getElementById('systemIp').textContent = info.ip;
                }
                
                // –í—Ä–µ–º—è —Å–∏—Å—Ç–µ–º—ã
                if (info.time) {
                    document.getElementById('lastUpdate').textContent = info.time;
                }
                
                // –ê–ø—Ç–∞–π–º
                if (info.uptime) {
                    const days = Math.floor(info.uptime / 86400);
                    const hours = Math.floor((info.uptime % 86400) / 3600);
                    const minutes = Math.floor((info.uptime % 3600) / 60);
                    document.getElementById('uptime').textContent = `${days}–¥ ${hours}—á ${minutes}–º`;
                }
            }
            
            updateArduinoStatus(status) {
                const element = document.getElementById('arduinoStatus');
                if (status === 1) {
                    element.textContent = '–û–Ω–ª–∞–π–Ω';
                    element.className = 'status-online';
                    document.getElementById('sensorStatus').textContent = '–†–∞–±–æ—Ç–∞–µ—Ç';
                } else {
                    element.textContent = '–û—Ñ–ª–∞–π–Ω';
                    element.className = 'status-offline';
                    document.getElementById('sensorStatus').textContent = '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö';
                }
            }
            
            updateFirebaseStatus(isConnected) {
                const dot = document.querySelector('.status-dot');
                const text = document.querySelector('#connectionStatus span:last-child');
                
                if (isConnected) {
                    dot.style.background = '#10b981';
                    text.textContent = '–ü–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ Firebase';
                    this.showToast('‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ —Å–µ—Ä–≤–µ—Ä—É', 'success');
                } else {
                    dot.style.background = '#ef4444';
                    text.textContent = '–û—Ç–∫–ª—é—á–µ–Ω–æ –æ—Ç Firebase';
                }
            }
            
            updateStatus(message, type = 'info') {
                console.log(`üì¢ ${message}`);
                this.showToast(message, type);
            }
            
            updateStats(stats) {
                // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
                console.log('–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:', stats);
            }
            
            setupEventListeners() {
                // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–≤–µ—Ç–æ–º
                document.getElementById('toggleLightBtn').addEventListener('click', () => {
                    this.sendCommand('light', this.data.light ? 'OFF' : 'ON');
                });
                
                // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞—Å–æ—Å–æ–º
                document.getElementById('togglePumpBtn').addEventListener('click', () => {
                    this.sendCommand('pump', this.data.pump ? 'OFF' : 'ON');
                });
                
                // –ë—ã—Å—Ç—Ä—ã–π –ø–æ–ª–∏–≤
                document.getElementById('manualPumpBtn').addEventListener('click', () => {
                    this.sendCommand('pump', 'ON');
                    setTimeout(() => this.sendCommand('pump', 'OFF'), 10000);
                    this.showToast('‚è±Ô∏è –ü–æ–ª–∏–≤ –Ω–∞ 10 —Å–µ–∫—É–Ω–¥', 'info');
                });
                
                // –ü–æ—Ä–æ–≥ –≤–ª–∞–∂–Ω–æ—Å—Ç–∏
                document.getElementById('moistureThreshold').addEventListener('input', (e) => {
                    document.getElementById('thresholdValue').textContent = e.target.value + '%';
                });
                
                document.getElementById('moistureThreshold').addEventListener('change', (e) => {
                    this.sendCommand('threshold', e.target.value);
                });
                
                // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–∂–∏–º
                let autoMode = true;
                document.getElementById('autoToggleBtn').addEventListener('click', () => {
                    autoMode = !autoMode;
                    const btn = document.getElementById('autoToggleBtn');
                    if (autoMode) {
                        btn.innerHTML = '<i class="fas fa-robot"></i> –ê–≤—Ç–æ: –í–ö–õ';
                        btn.style.background = '#10b981';
                        this.sendCommand('auto', 'ON');
                    } else {
                        btn.innerHTML = '<i class="fas fa-hand-paper"></i> –ê–≤—Ç–æ: –í–´–ö–õ';
                        btn.style.background = '#ef4444';
                        this.sendCommand('auto', 'OFF');
                    }
                });
            }
            
            async sendCommand(type, value) {
                if (!this.db) {
                    this.showToast('‚ùå –ù–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Firebase', 'error');
                    return;
                }
                
                try {
                    await this.db.ref(`commands/${type}`).set(value);
                    console.log(`‚úÖ –ö–æ–º–∞–Ω–¥–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞: ${type}=${value}`);
                    this.showToast(`–ö–æ–º–∞–Ω–¥–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞: ${type}=${value}`, 'success');
                } catch (error) {
                    console.error('‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∫–æ–º–∞–Ω–¥—ã:', error);
                    this.showToast('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∫–æ–º–∞–Ω–¥—ã', 'error');
                }
            }
            
            startTimers() {
                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏
                setInterval(() => {
                    const now = new Date();
                    const timeString = now.toLocaleTimeString('ru-RU');
                    const lastUpdate = document.getElementById('lastUpdate');
                    if (lastUpdate.textContent === '--:--:--') {
                        lastUpdate.textContent = timeString;
                    }
                }, 1000);
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
                setInterval(() => {
                    if (!this.db) {
                        this.updateStatus('–ü–æ—Ç–µ—Ä—è–Ω–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å Firebase', 'error');
                    }
                }, 30000);
            }
            
            startLocalMode() {
                console.log('üîÑ –†–µ–∂–∏–º –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è');
                this.showToast('‚ö†Ô∏è –†–∞–±–æ—Ç–∞ –≤ –ª–æ–∫–∞–ª—å–Ω–æ–º —Ä–µ–∂–∏–º–µ', 'warning');
                
                // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
                setInterval(() => {
                    this.data.moisture = Math.max(20, Math.min(80, this.data.moisture + (Math.random() - 0.5) * 5));
                    this.data.light = Math.random() > 0.7 ? 1 : 0;
                    this.data.pump = Math.random() > 0.9 ? 1 : 0;
                    
                    this.updateUI();
                    this.updateChart();
                }, 3000);
            }
            
            showToast(message, type = 'info') {
                const container = document.getElementById('toastContainer');
                if (!container) return;
                
                const toast = document.createElement('div');
                toast.className = 'toast';
                toast.style.cssText = `
                    background: #1e293b;
                    color: white;
                    padding: 12px 20px;
                    margin: 5px;
                    border-radius: 5px;
                    border-left: 4px solid ${type === 'success' ? '#10b981' : type === 'error' ? '#ef4444' : type === 'warning' ? '#f59e0b' : '#3b82f6'};
                    animation: slideIn 0.3s ease;
                `;
                
                let icon = 'fas fa-info-circle';
                if (type === 'success') icon = 'fas fa-check-circle';
                if (type === 'error') icon = 'fas fa-exclamation-circle';
                if (type === 'warning') icon = 'fas fa-exclamation-triangle';
                
                toast.innerHTML = `<i class="${icon}" style="margin-right:10px;"></i> ${message}`;
                
                container.appendChild(toast);
                
                // –£–¥–∞–ª—è–µ–º —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
                setTimeout(() => {
                    toast.style.opacity = '0';
                    toast.style.transform = 'translateX(100px)';
                    setTimeout(() => toast.remove(), 300);
                }, 5000);
                
                // –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç–∏–ª–∏ –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏
                if (!document.querySelector('#toastStyles')) {
                    const style = document.createElement('style');
                    style.id = 'toastStyles';
                    style.textContent = `
                        @keyframes slideIn {
                            from { transform: translateX(100px); opacity: 0; }
                            to { transform: translateX(0); opacity: 1; }
                        }
                    `;
                    document.head.appendChild(style);
                }
            }
        }
        
        // –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∫–æ–≥–¥–∞ –≤—Å–µ –∑–∞–≥—Ä—É–∑–∏—Ç—Å—è
        window.addEventListener('load', () => {
            console.log('üìÑ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
            setTimeout(() => {
                window.app = new EcoGrowApp();
            }, 500);
        });
    </script>
</body>
</html>
