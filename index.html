<!DOCTYPE html>
<html lang="ru" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üå± EcoGrow - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º–æ–π –ø–æ–ª–∏–≤–∞</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* ===== CSS –ü–ï–†–ï–ú–ï–ù–ù–´–ï ===== */
        :root {
            --primary-color: #27ae60;
            --primary-light: #2ecc71;
            --primary-dark: #229954;
            --secondary-color: #3498db;
            --danger-color: #e74c3c;
            --warning-color: #f39c12;
            --info-color: #9b59b6;
            --dark-color: #2c3e50;
            --light-color: #ecf0f1;
            --gray-color: #95a5a6;
            --success-color: #27ae60;
            
            --bg-primary: #f8f9fa;
            --bg-secondary: #ffffff;
            --bg-card: #ffffff;
            --bg-input: #ffffff;
            --border-color: #e1e8ed;
            --text-primary: #2c3e50;
            --text-secondary: #7f8c8d;
            --shadow-color: rgba(0, 0, 0, 0.1);
            --hover-color: rgba(0, 0, 0, 0.03);
            
            --shadow: 0 4px 12px var(--shadow-color);
            --radius: 15px;
            --transition: all 0.3s ease;
        }
        
        /* ===== –¢–ï–ú–ù–ê–Ø –¢–ï–ú–ê ===== */
        [data-theme="dark"] {
            --primary-color: #27ae60;
            --primary-light: #2ecc71;
            --primary-dark: #229954;
            --secondary-color: #3498db;
            --danger-color: #e74c3c;
            --warning-color: #f39c12;
            --info-color: #9b59b6;
            --dark-color: #ecf0f1;
            --light-color: #2c3e50;
            --gray-color: #7f8c8d;
            
            --bg-primary: #1a1a2e;
            --bg-secondary: #16213e;
            --bg-card: #16213e;
            --bg-input: #0f3460;
            --border-color: #2c3e50;
            --text-primary: #ecf0f1;
            --text-secondary: #bdc3c7;
            --shadow-color: rgba(0, 0, 0, 0.3);
            --hover-color: rgba(255, 255, 255, 0.05);
        }
        
        /* ===== –û–°–ù–û–í–ù–´–ï –°–¢–ò–õ–ò ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            transition: background-color 0.3s, color 0.3s, border-color 0.3s;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 100%);
            color: var(--text-primary);
            min-height: 100vh;
            padding: 20px;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        /* ===== –®–ê–ü–ö–ê ===== */
        .header {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-light));
            color: white;
            padding: 25px 30px;
            border-radius: var(--radius);
            margin-bottom: 25px;
            box-shadow: var(--shadow);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .header-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .header h1 {
            font-size: 2.2rem;
            display: flex;
            align-items: center;
            gap: 15px;
            font-weight: 700;
        }
        
        .header-subtitle {
            font-size: 1rem;
            opacity: 0.9;
            margin-top: 5px;
        }
        
        .header-right {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        /* ===== –ö–ù–û–ü–ö–ò –¢–ï–ú–´ –ò –°–¢–ê–¢–£–°–ê ===== */
        .theme-toggle, .status-badge {
            padding: 10px 20px;
            border-radius: 50px;
            border: none;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: var(--transition);
        }
        
        .theme-toggle {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            backdrop-filter: blur(10px);
        }
        
        .theme-toggle:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }
        
        .status-badge {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            font-size: 0.9rem;
        }
        
        .status-online {
            background: rgba(46, 204, 113, 0.3);
        }
        
        .status-offline {
            background: rgba(231, 76, 60, 0.3);
        }
        
        /* ===== –°–ï–¢–ö–ê –ö–ê–†–¢–û–ß–ï–ö ===== */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
            margin-bottom: 25px;
        }
        
        .card {
            background: var(--bg-card);
            border-radius: var(--radius);
            padding: 25px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
            transition: var(--transition);
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px var(--shadow-color);
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--border-color);
        }
        
        .card-title {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .card-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--primary-color), var(--primary-light));
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.2rem;
        }
        
        .card-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
        }
        
        .badge-success {
            background: rgba(39, 174, 96, 0.15);
            color: var(--primary-color);
        }
        
        .badge-warning {
            background: rgba(243, 156, 18, 0.15);
            color: var(--warning-color);
        }
        
        .badge-danger {
            background: rgba(231, 76, 60, 0.15);
            color: var(--danger-color);
        }
        
        .badge-info {
            background: rgba(52, 152, 219, 0.15);
            color: var(--secondary-color);
        }
        
        /* ===== –°–¢–ê–¢–ò–°–¢–ò–ö–ê ===== */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .stat-card {
            background: var(--hover-color);
            padding: 15px;
            border-radius: 12px;
            text-align: center;
            transition: var(--transition);
        }
        
        .stat-card:hover {
            background: var(--border-color);
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary-color);
            line-height: 1;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }
        
        /* ===== –ì–†–ê–§–ò–ö ===== */
        .chart-container {
            height: 250px;
            margin: 20px 0;
            position: relative;
        }
        
        /* ===== –ö–ù–û–ü–ö–ò –£–ü–†–ê–í–õ–ï–ù–ò–Ø ===== */
        .controls-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 20px 0;
        }
        
        @media (max-width: 768px) {
            .controls-grid {
                grid-template-columns: 1fr;
            }
        }
        
        .btn {
            padding: 14px 20px;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .btn i {
            font-size: 1.2rem;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--secondary-color), #2980b9);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(52, 152, 219, 0.4);
        }
        
        .btn-success {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: white;
        }
        
        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(39, 174, 96, 0.4);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, var(--danger-color), #c0392b);
            color: white;
        }
        
        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(231, 76, 60, 0.4);
        }
        
        .btn-warning {
            background: linear-gradient(135deg, var(--warning-color), #e67e22);
            color: white;
        }
        
        .btn-warning:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(243, 156, 18, 0.4);
        }
        
        .btn-secondary {
            background: var(--border-color);
            color: var(--text-primary);
        }
        
        .btn-secondary:hover {
            background: var(--hover-color);
            transform: translateY(-2px);
        }
        
        /* ===== –ù–ê–°–¢–†–û–ô–ö–ò ===== */
        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .setting-item {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .setting-label {
            font-size: 0.95rem;
            font-weight: 500;
            color: var(--text-primary);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .setting-value {
            color: var(--primary-color);
            font-weight: 600;
        }
        
        .setting-input {
            padding: 12px 15px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            background: var(--bg-input);
            color: var(--text-primary);
            font-size: 1rem;
            transition: var(--transition);
        }
        
        .setting-input:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 3px rgba(39, 174, 96, 0.2);
        }
        
        input[type="range"] {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: var(--border-color);
            outline: none;
            -webkit-appearance: none;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            background: var(--primary-color);
            cursor: pointer;
            border: 3px solid var(--bg-card);
            box-shadow: 0 2px 5px var(--shadow-color);
        }
        
        /* ===== –ü–ï–†–ï–ö–õ–Æ–ß–ê–¢–ï–õ–ò ===== */
        .switch-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid var(--border-color);
        }
        
        .switch-row:last-child {
            border-bottom: none;
        }
        
        .switch-label {
            display: flex;
            flex-direction: column;
            gap: 3px;
        }
        
        .switch-title {
            font-weight: 500;
        }
        
        .switch-subtitle {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }
        
        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 30px;
        }
        
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--border-color);
            border-radius: 34px;
            transition: var(--transition);
        }
        
        .slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            border-radius: 50%;
            transition: var(--transition);
        }
        
        input:checked + .slider {
            background-color: var(--primary-color);
        }
        
        input:checked + .slider:before {
            transform: translateX(30px);
        }
        
        /* ===== –û–®–ò–ë–ö–ò ===== */
        .errors-list {
            max-height: 200px;
            overflow-y: auto;
            margin: 15px 0;
            padding-right: 10px;
        }
        
        .error-item {
            background: rgba(231, 76, 60, 0.1);
            padding: 12px;
            margin-bottom: 8px;
            border-radius: 8px;
            border-left: 4px solid var(--danger-color);
        }
        
        .error-time {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
            color: var(--danger-color);
            font-size: 0.9rem;
            margin-bottom: 3px;
        }
        
        .error-msg {
            color: var(--text-primary);
            font-size: 0.9rem;
            line-height: 1.3;
        }
        
        /* ===== –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø ===== */
        .notification {
            position: fixed;
            top: 25px;
            right: 25px;
            background: var(--bg-card);
            color: var(--text-primary);
            padding: 15px 20px;
            border-radius: 12px;
            box-shadow: var(--shadow);
            z-index: 1000;
            border-left: 5px solid var(--primary-color);
            transform: translateX(120%);
            transition: transform 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            max-width: 350px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification.error {
            border-left-color: var(--danger-color);
        }
        
        .notification.warning {
            border-left-color: var(--warning-color);
        }
        
        .notification.success {
            border-left-color: var(--primary-color);
        }
        
        /* ===== –ó–ê–ì–†–£–ó–ö–ê ===== */
        .loading {
            text-align: center;
            padding: 40px;
            color: var(--text-secondary);
        }
        
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid var(--border-color);
            border-radius: 50%;
            border-top-color: var(--primary-color);
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* ===== –¢–ê–ô–ú–ï–† ===== */
        .timer-display {
            background: linear-gradient(135deg, rgba(39, 174, 96, 0.1), rgba(46, 204, 113, 0.15));
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            margin: 20px 0;
            border: 2px solid rgba(39, 174, 96, 0.2);
        }
        
        .timer-value {
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--primary-color);
            text-shadow: 1px 1px 3px var(--shadow-color);
            line-height: 1;
        }
        
        .timer-label {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-top: 8px;
        }
        
        /* ===== –ú–û–ë–ò–õ–¨–ù–ê–Ø –ê–î–ê–ü–¢–ê–¶–ò–Ø ===== */
        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                text-align: center;
                padding: 20px;
            }
            
            .header-left, .header-right {
                width: 100%;
                justify-content: center;
            }
            
            .header h1 {
                font-size: 1.8rem;
            }
            
            .dashboard-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .card {
                padding: 20px;
            }
        }
        
        /* ===== –®–ò–†–û–ö–ò–ï –ö–ê–†–¢–û–ß–ö–ò ===== */
        .wide-card {
            grid-column: 1 / -1;
        }
        
        /* ===== –í–†–ï–ú–Ø ===== */
        .time-display {
            font-size: 1.1rem;
            color: var(--primary-color);
            font-weight: 600;
            text-align: center;
            margin: 15px 0;
            padding: 10px;
            background: rgba(52, 152, 219, 0.1);
            border-radius: 8px;
        }
        
        /* ===== –ò–ù–ü–£–¢ –ì–†–£–ü–ü–ê ===== */
        .input-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        /* ===== –°–ö–†–û–õ–õ–ë–ê–† ===== */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: var(--border-color);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--primary-color);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary-dark);
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- –®–ê–ü–ö–ê -->
        <div class="header">
            <div class="header-left">
                <div>
                    <h1><i class="fas fa-seedling"></i> EcoGrow Control Panel</h1>
                    <div class="header-subtitle">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º–æ–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–æ–ª–∏–≤–∞ —Ä–∞—Å—Ç–µ–Ω–∏–π</div>
                </div>
            </div>
            <div class="header-right">
                <button class="theme-toggle" onclick="toggleTheme()">
                    <i class="fas fa-moon"></i> –¢—ë–º–Ω–∞—è —Ç–µ–º–∞
                </button>
                <div id="connectionStatus" class="status-badge status-online">
                    <i class="fas fa-wifi"></i> <span>–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...</span>
                </div>
            </div>
        </div>
        
        <!-- –°–¢–ê–¢–£–° –ü–û–î–ö–õ–Æ–ß–ï–ù–ò–Ø -->
        <div id="loadingPanel" class="card">
            <div class="loading">
                <div class="loading-spinner"></div>
                <p>–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –æ–±–ª–∞–∫—É Firebase...</p>
            </div>
        </div>
        
        <!-- –û–°–ù–û–í–ù–ê–Ø –ü–ê–ù–ï–õ–¨ (—Å–∫—Ä—ã—Ç–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ) -->
        <div id="mainPanel" style="display: none;">
            <div class="dashboard-grid">
                <!-- –ö–ê–†–¢–û–ß–ö–ê –¢–ï–ö–£–©–ï–ì–û –°–û–°–¢–û–Ø–ù–ò–Ø -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <div class="card-icon">
                                <i class="fas fa-tachometer-alt"></i>
                            </div>
                            <span>–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ</span>
                        </div>
                        <div id="deviceStatus" class="card-badge badge-success">–û–ù–õ–ê–ô–ù</div>
                    </div>
                    
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div id="moistureValue" class="stat-value">--%</div>
                            <div class="stat-label">–í–ª–∞–∂–Ω–æ—Å—Ç—å –ø–æ—á–≤—ã</div>
                        </div>
                        <div class="stat-card">
                            <div id="pumpValue" class="stat-value">–í–´–ö–õ</div>
                            <div class="stat-label">–ù–∞—Å–æ—Å</div>
                        </div>
                        <div class="stat-card">
                            <div id="lightValue" class="stat-value">–í–´–ö–õ</div>
                            <div class="stat-label">–°–≤–µ—Ç</div>
                        </div>
                        <div class="stat-card">
                            <div id="tempValue" class="stat-value">--¬∞C</div>
                            <div class="stat-label">–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞</div>
                        </div>
                    </div>
                    
                    <div class="time-display">
                        <i class="far fa-clock"></i> –ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: <span id="lastUpdate">--:--</span>
                    </div>
                </div>
                
                <!-- –ö–ê–†–¢–û–ß–ö–ê –ì–†–ê–§–ò–ö–ê –í–õ–ê–ñ–ù–û–°–¢–ò -->
                <div class="card wide-card">
                    <div class="card-header">
                        <div class="card-title">
                            <div class="card-icon" style="background: linear-gradient(135deg, #3498db, #2980b9);">
                                <i class="fas fa-chart-line"></i>
                            </div>
                            <span>–ì—Ä–∞—Ñ–∏–∫ –≤–ª–∞–∂–Ω–æ—Å—Ç–∏</span>
                        </div>
                        <div class="card-badge badge-info">
                            <span id="historyCount">0</span> —Ç–æ—á–µ–∫
                        </div>
                    </div>
                    
                    <div class="chart-container">
                        <canvas id="moistureChart"></canvas>
                    </div>
                    
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div id="avgMoisture" class="stat-value">--%</div>
                            <div class="stat-label">–°—Ä–µ–¥–Ω—è—è</div>
                        </div>
                        <div class="stat-card">
                            <div id="minMoisture" class="stat-value">--%</div>
                            <div class="stat-label">–ú–∏–Ω–∏–º—É–º</div>
                        </div>
                        <div class="stat-card">
                            <div id="maxMoisture" class="stat-value">--%</div>
                            <div class="stat-label">–ú–∞–∫—Å–∏–º—É–º</div>
                        </div>
                        <div class="stat-card">
                            <div id="trendValue" class="stat-value">‚Üí</div>
                            <div class="stat-label">–¢—Ä–µ–Ω–¥</div>
                        </div>
                    </div>
                </div>
                
                <!-- –ö–ê–†–¢–û–ß–ö–ê –£–ü–†–ê–í–õ–ï–ù–ò–Ø –ù–ê–°–û–°–û–ú -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <div class="card-icon" style="background: linear-gradient(135deg, #9b59b6, #8e44ad);">
                                <i class="fas fa-tint"></i>
                            </div>
                            <span>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞—Å–æ—Å–æ–º</span>
                        </div>
                        <div id="pumpMode" class="card-badge badge-warning">–ê–í–¢–û</div>
                    </div>
                    
                    <div class="controls-grid">
                        <button class="btn btn-success" onclick="sendCommand('pump', 1)">
                            <i class="fas fa-play"></i> –í–∫–ª—é—á–∏—Ç—å
                        </button>
                        <button class="btn btn-danger" onclick="sendCommand('pump', 0)">
                            <i class="fas fa-stop"></i> –í—ã–∫–ª—é—á–∏—Ç—å
                        </button>
                        <button class="btn btn-primary" onclick="sendCommand('pumpAuto', 1)">
                            <i class="fas fa-sync-alt"></i> –ê–≤—Ç–æ—Ä–µ–∂–∏–º
                        </button>
                        <button class="btn btn-warning" onclick="manualWatering()">
                            <i class="fas fa-hand-pointer"></i> –ü–æ–ª–∏—Ç—å —Å–µ–π—á–∞—Å
                        </button>
                    </div>
                    
                    <div class="settings-grid" style="margin-top: 20px;">
                        <div class="setting-item">
                            <label class="setting-label">
                                –ü–æ—Ä–æ–≥ –≤–ª–∞–∂–Ω–æ—Å—Ç–∏
                                <span id="thresholdValue" class="setting-value">50%</span>
                            </label>
                            <input type="range" id="thresholdSlider" min="10" max="90" step="1" value="50" 
                                   oninput="updateThresholdValue(this.value)" onchange="setThreshold()">
                        </div>
                        
                        <div class="setting-item">
                            <label class="setting-label">–í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã –Ω–∞—Å–æ—Å–∞ (—Å–µ–∫)</label>
                            <input type="number" id="pumpTimeInput" class="setting-input" min="1" max="600" value="10">
                            <button class="btn btn-primary" onclick="setPumpTime()" style="margin-top: 10px;">
                                –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
                            </button>
                        </div>
                    </div>
                    
                    <div class="timer-display">
                        <div id="timerValue" class="timer-value">--</div>
                        <div class="timer-label">–î–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ –ø–æ–ª–∏–≤–∞ (–º–∏–Ω—É—Ç)</div>
                    </div>
                </div>
                
                <!-- –ö–ê–†–¢–û–ß–ö–ê –£–ü–†–ê–í–õ–ï–ù–ò–Ø –°–í–ï–¢–û–ú -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <div class="card-icon" style="background: linear-gradient(135deg, #f39c12, #e67e22);">
                                <i class="fas fa-lightbulb"></i>
                            </div>
                            <span>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–≤–µ—Ç–æ–º</span>
                        </div>
                        <div id="lightMode" class="card-badge badge-warning">–ê–í–¢–û</div>
                    </div>
                    
                    <div class="controls-grid">
                        <button class="btn btn-success" onclick="sendCommand('light', 1)">
                            <i class="fas fa-power-off"></i> –í–∫–ª—é—á–∏—Ç—å
                        </button>
                        <button class="btn btn-danger" onclick="sendCommand('light', 0)">
                            <i class="fas fa-moon"></i> –í—ã–∫–ª—é—á–∏—Ç—å
                        </button>
                        <button class="btn btn-primary" onclick="sendCommand('lightAuto', 1)">
                            <i class="fas fa-sync-alt"></i> –ê–≤—Ç–æ—Ä–µ–∂–∏–º
                        </button>
                    </div>
                    
                    <div class="settings-grid" style="margin-top: 20px;">
                        <div class="setting-item">
                            <label class="setting-label">–í—Ä–µ–º—è –≤–∫–ª—é—á–µ–Ω–∏—è —Å–≤–µ—Ç–∞</label>
                            <input type="time" id="lightStartTime" class="setting-input" value="08:00">
                        </div>
                        
                        <div class="setting-item">
                            <label class="setting-label">–í—Ä–µ–º—è –≤—ã–∫–ª—é—á–µ–Ω–∏—è —Å–≤–µ—Ç–∞</label>
                            <input type="time" id="lightEndTime" class="setting-input" value="20:00">
                        </div>
                    </div>
                    
                    <div class="switch-row">
                        <div class="switch-label">
                            <div class="switch-title">–ê–≤—Ç–æ–≤–∫–ª—é—á–µ–Ω–∏–µ –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é</div>
                            <div class="switch-subtitle">–í–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–≤–µ—Ç–æ–º</div>
                        </div>
                        <label class="switch">
                            <input type="checkbox" id="lightScheduleEnabled" onchange="toggleLightSchedule()">
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>
                
                <!-- –ö–ê–†–¢–û–ß–ö–ê –ù–ê–°–¢–†–û–ï–ö -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <div class="card-icon" style="background: linear-gradient(135deg, #34495e, #2c3e50);">
                                <i class="fas fa-cog"></i>
                            </div>
                            <span>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã</span>
                        </div>
                    </div>
                    
                    <div class="settings-grid">
                        <div class="setting-item">
                            <label class="setting-label">–ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –ø–æ–ª–∏–≤–∞–º–∏ (–º–∏–Ω)</label>
                            <input type="number" id="wateringInterval" class="setting-input" min="5" max="1440" value="30">
                            <button class="btn btn-primary" onclick="setWateringInterval()" style="margin-top: 10px;">
                                –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
                            </button>
                        </div>
                        
                        <div class="setting-item">
                            <label class="setting-label">–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Ä–µ–º—è (–ß–ß:–ú–ú)</label>
                            <input type="time" id="setTimeInput" class="setting-input" value="12:00">
                            <button class="btn btn-primary" onclick="setDeviceTime()" style="margin-top: 10px;">
                                –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å
                            </button>
                        </div>
                    </div>
                    
                    <div class="switch-row">
                        <div class="switch-label">
                            <div class="switch-title">–†–µ–∂–∏–º —Å–Ω–∞</div>
                            <div class="switch-subtitle">–û—Ç–∫–ª—é—á–∞—Ç—å –ø–æ–ª–∏–≤ –≤ –Ω–æ—á–Ω–æ–µ –≤—Ä–µ–º—è</div>
                        </div>
                        <label class="switch">
                            <input type="checkbox" id="sleepModeEnabled" onchange="toggleSleepMode()">
                            <span class="slider"></span>
                        </label>
                    </div>
                    
                    <div class="switch-row">
                        <div class="switch-label">
                            <div class="switch-title">Push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</div>
                            <div class="switch-subtitle">–ü–æ–ª—É—á–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ –±—Ä–∞—É–∑–µ—Ä–µ</div>
                        </div>
                        <label class="switch">
                            <input type="checkbox" id="notificationsEnabled" onchange="toggleNotifications()">
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>
                
                <!-- –ö–ê–†–¢–û–ß–ö–ê –û–®–ò–ë–û–ö -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <div class="card-icon" style="background: linear-gradient(135deg, #e74c3c, #c0392b);">
                                <i class="fas fa-exclamation-triangle"></i>
                            </div>
                            <span>–û—à–∏–±–∫–∏ —Å–∏—Å—Ç–µ–º—ã</span>
                        </div>
                        <div id="errorCount" class="card-badge badge-danger">0</div>
                    </div>
                    
                    <div id="errorsContainer" class="errors-list">
                        <div class="error-item">
                            <div class="error-msg">–û—à–∏–±–æ–∫ –Ω–µ—Ç</div>
                        </div>
                    </div>
                    
                    <div class="controls-grid" style="margin-top: 20px;">
                        <button class="btn btn-danger" onclick="clearErrors()">
                            <i class="fas fa-trash"></i> –û—á–∏—Å—Ç–∏—Ç—å –æ—à–∏–±–∫–∏
                        </button>
                        <button class="btn btn-secondary" onclick="refreshData()">
                            <i class="fas fa-redo"></i> –û–±–Ω–æ–≤–∏—Ç—å
                        </button>
                    </div>
                </div>
                
                <!-- –ö–ê–†–¢–û–ß–ö–ê –°–¢–ê–¢–ò–°–¢–ò–ö–ò -->
                <div class="card wide-card">
                    <div class="card-header">
                        <div class="card-title">
                            <div class="card-icon" style="background: linear-gradient(135deg, #1abc9c, #16a085);">
                                <i class="fas fa-chart-bar"></i>
                            </div>
                            <span>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</span>
                        </div>
                        <div class="card-badge badge-info">–ó–∞ –≤—Å—ë –≤—Ä–µ–º—è</div>
                    </div>
                    
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div id="totalWaterings" class="stat-value">0</div>
                            <div class="stat-label">–í—Å–µ–≥–æ –ø–æ–ª–∏–≤–æ–≤</div>
                        </div>
                        <div class="stat-card">
                            <div id="totalLightHours" class="stat-value">0—á</div>
                            <div class="stat-label">–†–∞–±–æ—Ç–∞ —Å–≤–µ—Ç–∞</div>
                        </div>
                        <div class="stat-card">
                            <div id="totalEnergy" class="stat-value">0–í—Ç¬∑—á</div>
                            <div class="stat-label">–≠–Ω–µ—Ä–≥–æ–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ</div>
                        </div>
                        <div class="stat-card">
                            <div id="uptimeValue" class="stat-value">0–¥</div>
                            <div class="stat-label">–í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø -->
    <div id="notification" class="notification">
        <i class="fas fa-info-circle"></i>
        <span id="notificationText">–°–æ–æ–±—â–µ–Ω–∏–µ</span>
    </div>

    <script>
        // ============================================
        // –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø FIREBASE (–ó–ê–ú–ï–ù–ò–¢–ï –ù–ê –°–í–û–Æ!)
        // ============================================
        const firebaseConfig = {
            apiKey: "AIzaSyBJSFgQqIrsXj88Xq9h_vwzWjsbZq3z7r8",
            authDomain: "ecogrow-remote.firebaseapp.com",
            databaseURL: "https://ecogrow-remote-default-rtdb.firebaseio.com",
            projectId: "ecogrow-remote",
            storageBucket: "ecogrow-remote.appspot.com",
            messagingSenderId: "123456789012",
            appId: "1:123456789012:web:abcdef1234567890abcdef"
        };

        // ============================================
        // –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï
        // ============================================
        let database = null;
        let deviceRef = null;
        let settingsRef = null;
        let commandsRef = null;
        
        // ID —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ (–æ–¥–∏–Ω —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π)
        const DEVICE_ID = "device1";
        
        // –ò—Å—Ç–æ—Ä–∏—è –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞
        let moistureHistory = {
            labels: [],
            values: [],
            timestamps: []
        };
        const MAX_HISTORY_POINTS = 80;
        
        // –¢–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ
        let currentData = {
            moisture: 0,
            pump: false,
            light: false,
            temperature: 0,
            timestamp: 0,
            threshold: 50,
            pumpTime: 10,
            wateringInterval: 30,
            errors: []
        };
        
        // –ì—Ä–∞—Ñ–∏–∫
        let moistureChart = null;
        
        // ============================================
        // –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø
        // ============================================
        document.addEventListener('DOMContentLoaded', function() {
            console.log("üå± EcoGrow Control Panel –∑–∞–≥—Ä—É–∂–µ–Ω");
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—É—é —Ç–µ–º—É
            loadTheme();
            
            try {
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase
                const app = firebase.initializeApp(firebaseConfig);
                database = firebase.database();
                console.log("‚úÖ Firebase –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω");
                
                // –°—Å—ã–ª–∫–∏ –Ω–∞ –¥–∞–Ω–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
                deviceRef = database.ref('devices/' + DEVICE_ID + '/data');
                settingsRef = database.ref('devices/' + DEVICE_ID + '/settings');
                commandsRef = database.ref('devices/' + DEVICE_ID + '/commands/latest');
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Firebase
                checkFirebaseConnection();
                
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≥—Ä–∞—Ñ–∏–∫–∞
                initChart();
                
                // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
                loadDeviceData();
                
                // –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫
                loadSettings();
                
                // –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 3 —Å–µ–∫—É–Ω–¥—ã
                setInterval(loadDeviceData, 3000);
                setInterval(loadSettings, 5000);
                
                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
                setInterval(updateLocalTime, 1000);
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—Å–Ω–æ–≤–Ω—É—é –ø–∞–Ω–µ–ª—å
                setTimeout(() => {
                    document.getElementById('loadingPanel').style.display = 'none';
                    document.getElementById('mainPanel').style.display = 'block';
                }, 1000);
                
            } catch (error) {
                console.error("‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:", error);
                showNotification('‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Firebase: ' + error.message, 'error');
            }
        });

        // ============================================
        // FIREBASE –§–£–ù–ö–¶–ò–ò
        // ============================================
        function checkFirebaseConnection() {
            if (!database) return;
            
            database.ref('.info/connected').on('value', (snapshot) => {
                const connected = snapshot.val();
                const statusEl = document.getElementById('connectionStatus');
                
                if (connected) {
                    statusEl.innerHTML = '<i class="fas fa-wifi"></i> <span>–ü–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ –æ–±–ª–∞–∫—É</span>';
                    statusEl.className = 'status-badge status-online';
                    document.getElementById('deviceStatus').textContent = '–û–ù–õ–ê–ô–ù';
                    document.getElementById('deviceStatus').className = 'card-badge badge-success';
                } else {
                    statusEl.innerHTML = '<i class="fas fa-wifi-slash"></i> <span>–ù–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è</span>';
                    statusEl.className = 'status-badge status-offline';
                    document.getElementById('deviceStatus').textContent = '–û–§–§–õ–ê–ô–ù';
                    document.getElementById('deviceStatus').className = 'card-badge badge-danger';
                }
            });
        }

        function loadDeviceData() {
            if (!deviceRef) return;
            
            deviceRef.on('value', (snapshot) => {
                const data = snapshot.val();
                
                if (!data) {
                    console.warn("‚ö†Ô∏è –î–∞–Ω–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã");
                    return;
                }
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ
                currentData.moisture = data.moisture || 0;
                currentData.pump = data.pump || false;
                currentData.light = data.light || false;
                currentData.temperature = data.temperature || 0;
                currentData.timestamp = data.timestamp || 0;
                currentData.errors = data.errors || [];
                
                // –û–±–Ω–æ–≤–ª—è–µ–º UI
                updateDeviceInfo();
                
                // –î–æ–±–∞–≤–ª—è–µ–º —Ç–æ—á–∫—É –≤ –∏—Å—Ç–æ—Ä–∏—é
                addToHistory(currentData.moisture);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –≥—Ä–∞—Ñ–∏–∫
                updateChart();
                
            }, (error) => {
                console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:", error);
                showNotification('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞', 'error');
            });
        }

        function loadSettings() {
            if (!settingsRef) return;
            
            settingsRef.on('value', (snapshot) => {
                const data = snapshot.val();
                
                if (!data) return;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
                currentData.threshold = data.moistureThreshold || 50;
                currentData.pumpTime = data.pumpDuration || 10;
                currentData.wateringInterval = data.wateringInterval || 30;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º UI –Ω–∞—Å—Ç—Ä–æ–µ–∫
                updateSettingsUI();
                
            }, (error) => {
                console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫:", error);
            });
        }

        function sendCommand(command, value) {
            if (!commandsRef) {
                showNotification('‚ùå –ù–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Firebase', 'error');
                return;
            }
            
            console.log(`–û—Ç–ø—Ä–∞–≤–∫–∞ –∫–æ–º–∞–Ω–¥—ã: ${command}=${value}`);
            
            let commandData = {
                command: command,
                value: value,
                timestamp: Date.now(),
                source: 'web_interface'
            };
            
            // –î–æ–±–∞–≤–ª—è–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö –∫–æ–º–∞–Ω–¥
            if (command === 'setTime') {
                const timeInput = document.getElementById('setTimeInput').value;
                const [hours, minutes] = timeInput.split(':');
                commandData.hour = parseInt(hours);
                commandData.minute = parseInt(minutes);
            }
            else if (command === 'threshold') {
                commandData.value = parseInt(value);
            }
            
            commandsRef.set(commandData)
            .then(() => {
                const commands = {
                    'pump': {1: '–ù–∞—Å–æ—Å –≤–∫–ª—é—á–µ–Ω', 0: '–ù–∞—Å–æ—Å –≤—ã–∫–ª—é—á–µ–Ω'},
                    'light': {1: '–°–≤–µ—Ç –≤–∫–ª—é—á–µ–Ω', 0: '–°–≤–µ—Ç –≤—ã–∫–ª—é—á–µ–Ω'},
                    'pumpAuto': {1: '–ù–∞—Å–æ—Å: –∞–≤—Ç–æ—Ä–µ–∂–∏–º'},
                    'lightAuto': {1: '–°–≤–µ—Ç: –∞–≤—Ç–æ—Ä–µ–∂–∏–º'},
                    'threshold': {value: `–ü–æ—Ä–æ–≥ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –Ω–∞ ${value}%`},
                    'setTime': {1: '–í—Ä–µ–º—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–æ'},
                    'pumpTime': {value: `–í—Ä–µ–º—è –Ω–∞—Å–æ—Å–∞: ${value} —Å–µ–∫`}
                };
                
                let message = commands[command] ? 
                    (commands[command][value] || commands[command].value || `–ö–æ–º–∞–Ω–¥–∞ "${command}" –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞`) : 
                    `–ö–æ–º–∞–Ω–¥–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞`;
                
                showNotification('‚úÖ ' + message, 'success');
            })
            .catch(error => {
                console.error("–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∫–æ–º–∞–Ω–¥—ã:", error);
                showNotification('‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∫–æ–º–∞–Ω–¥—ã: ' + error.message, 'error');
            });
        }

        // ============================================
        // –û–ë–ù–û–í–õ–ï–ù–ò–ï –ò–ù–¢–ï–†–§–ï–ô–°–ê
        // ============================================
        function updateDeviceInfo() {
            // –í–ª–∞–∂–Ω–æ—Å—Ç—å
            document.getElementById('moistureValue').textContent = currentData.moisture + '%';
            document.getElementById('moistureValue').style.color = getMoistureColor(currentData.moisture);
            
            // –ù–∞—Å–æ—Å
            const pumpValue = document.getElementById('pumpValue');
            pumpValue.textContent = currentData.pump ? '–í–ö–õ' : '–í–´–ö–õ';
            pumpValue.style.color = currentData.pump ? 'var(--success-color)' : 'var(--danger-color)';
            pumpValue.className = 'stat-value ' + (currentData.pump ? 'status-on' : 'status-off');
            
            // –°–≤–µ—Ç
            const lightValue = document.getElementById('lightValue');
            lightValue.textContent = currentData.light ? '–í–ö–õ' : '–í–´–ö–õ';
            lightValue.style.color = currentData.light ? 'var(--warning-color)' : 'var(--gray-color)';
            
            // –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞
            document.getElementById('tempValue').textContent = currentData.temperature + '¬∞C';
            
            // –í—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
            if (currentData.timestamp > 0) {
                const date = new Date(currentData.timestamp * 1000);
                const timeStr = date.toLocaleTimeString('ru-RU', { 
                    hour: '2-digit', 
                    minute: '2-digit',
                    second: '2-digit'
                });
                document.getElementById('lastUpdate').textContent = timeStr;
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–∞–π–º–µ—Ä –¥–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ –ø–æ–ª–∏–≤–∞
            updateWateringTimer();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ—à–∏–±–∫–∏
            updateErrorsList();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
            updateStatistics();
        }

        function updateSettingsUI() {
            // –ü–æ—Ä–æ–≥ –≤–ª–∞–∂–Ω–æ—Å—Ç–∏
            document.getElementById('thresholdSlider').value = currentData.threshold;
            document.getElementById('thresholdValue').textContent = currentData.threshold + '%';
            
            // –í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã –Ω–∞—Å–æ—Å–∞
            document.getElementById('pumpTimeInput').value = currentData.pumpTime;
            
            // –ò–Ω—Ç–µ—Ä–≤–∞–ª –ø–æ–ª–∏–≤–∞
            document.getElementById('wateringInterval').value = currentData.wateringInterval;
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è –≤ –∏–Ω–ø—É—Ç
            const now = new Date();
            const timeStr = now.getHours().toString().padStart(2, '0') + ':' + 
                          now.getMinutes().toString().padStart(2, '0');
            document.getElementById('setTimeInput').value = timeStr;
        }

        function addToHistory(moisture) {
            const now = new Date();
            const timeLabel = now.getHours().toString().padStart(2, '0') + ':' + 
                            now.getMinutes().toString().padStart(2, '0');
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –ø—Ä–æ—à–ª–æ –±–æ–ª—å—à–µ 1 –º–∏–Ω—É—Ç—ã —Å –ø–æ—Å–ª–µ–¥–Ω–µ–π –∑–∞–ø–∏—Å–∏
            if (moistureHistory.timestamps.length === 0 || 
                (now - moistureHistory.timestamps[moistureHistory.timestamps.length - 1]) > 60000) {
                
                // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é
                if (moistureHistory.values.length >= MAX_HISTORY_POINTS) {
                    moistureHistory.labels.shift();
                    moistureHistory.values.shift();
                    moistureHistory.timestamps.shift();
                }
                
                moistureHistory.labels.push(timeLabel);
                moistureHistory.values.push(moisture);
                moistureHistory.timestamps.push(now);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫ —Ç–æ—á–µ–∫
                document.getElementById('historyCount').textContent = moistureHistory.values.length;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –≥—Ä–∞—Ñ–∏–∫–∞
                updateChartStats();
            }
        }

        // ============================================
        // –ì–†–ê–§–ò–ö
        // ============================================
        function initChart() {
            const ctx = document.getElementById('moistureChart').getContext('2d');
            moistureChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: moistureHistory.labels,
                    datasets: [{
                        label: '–í–ª–∞–∂–Ω–æ—Å—Ç—å (%)',
                        data: moistureHistory.values,
                        borderColor: 'var(--primary-color)',
                        backgroundColor: 'rgba(39, 174, 96, 0.1)',
                        borderWidth: 3,
                        tension: 0.4,
                        fill: true,
                        pointRadius: 0,
                        pointHoverRadius: 5,
                        pointBackgroundColor: 'var(--primary-color)',
                        pointBorderColor: '#ffffff',
                        pointBorderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            backgroundColor: 'var(--bg-card)',
                            titleColor: 'var(--text-primary)',
                            bodyColor: 'var(--text-primary)',
                            borderColor: 'var(--border-color)',
                            borderWidth: 1,
                            padding: 10,
                            cornerRadius: 8,
                            displayColors: false,
                            callbacks: {
                                label: function(context) {
                                    return `–í–ª–∞–∂–Ω–æ—Å—Ç—å: ${context.parsed.y}%`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            grid: {
                                color: 'var(--border-color)'
                            },
                            ticks: {
                                color: 'var(--text-secondary)',
                                font: {
                                    size: 11
                                }
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            },
                            ticks: {
                                color: 'var(--text-secondary)',
                                font: {
                                    size: 11
                                },
                                maxRotation: 0
                            }
                        }
                    },
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    }
                }
            });
        }

        function updateChart() {
            if (moistureChart) {
                moistureChart.data.labels = moistureHistory.labels;
                moistureChart.data.datasets[0].data = moistureHistory.values;
                moistureChart.update('none');
            }
        }

        function updateChartStats() {
            if (moistureHistory.values.length === 0) return;
            
            const values = moistureHistory.values;
            const sum = values.reduce((a, b) => a + b, 0);
            const avg = Math.round(sum / values.length);
            const min = Math.min(...values);
            const max = Math.max(...values);
            
            document.getElementById('avgMoisture').textContent = avg + '%';
            document.getElementById('minMoisture').textContent = min + '%';
            document.getElementById('maxMoisture').textContent = max + '%';
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç—Ä–µ–Ω–¥ (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 5 —Ç–æ—á–µ–∫)
            if (values.length >= 5) {
                const recent = values.slice(-5);
                const first = recent[0];
                const last = recent[recent.length - 1];
                const diff = last - first;
                
                let trend = '‚Üí';
                if (diff > 2) trend = '‚ÜóÔ∏è';
                else if (diff < -2) trend = '‚ÜòÔ∏è';
                
                document.getElementById('trendValue').textContent = trend;
            }
        }

        // ============================================
        // –§–£–ù–ö–¶–ò–ò –£–ü–†–ê–í–õ–ï–ù–ò–Ø
        // ============================================
        function updateThresholdValue(value) {
            document.getElementById('thresholdValue').textContent = value + '%';
        }

        function setThreshold() {
            const threshold = document.getElementById('thresholdSlider').value;
            if (threshold >= 10 && threshold <= 90) {
                sendCommand('threshold', parseInt(threshold));
            } else {
                showNotification('‚ùå –ü–æ—Ä–æ–≥ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç 10% –¥–æ 90%', 'error');
            }
        }

        function setPumpTime() {
            const pumpTime = document.getElementById('pumpTimeInput').value;
            if (pumpTime >= 1 && pumpTime <= 600) {
                sendCommand('pumpTime', parseInt(pumpTime));
            } else {
                showNotification('‚ùå –í—Ä–µ–º—è –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—Ç 1 –¥–æ 600 —Å–µ–∫—É–Ω–¥', 'error');
            }
        }

        function setWateringInterval() {
            const interval = document.getElementById('wateringInterval').value;
            if (interval >= 5 && interval <= 1440) {
                // –ó–¥–µ—Å—å –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É –∫–æ–º–∞–Ω–¥—ã –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ
                showNotification(`‚úÖ –ò–Ω—Ç–µ—Ä–≤–∞–ª –ø–æ–ª–∏–≤–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω: ${interval} –º–∏–Ω—É—Ç`, 'success');
            } else {
                showNotification('‚ùå –ò–Ω—Ç–µ—Ä–≤–∞–ª –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç 5 –¥–æ 1440 –º–∏–Ω—É—Ç', 'error');
            }
        }

        function setDeviceTime() {
            sendCommand('setTime', 1);
        }

        function manualWatering() {
            sendCommand('pump', 1);
            setTimeout(() => {
                sendCommand('pump', 0);
            }, currentData.pumpTime * 1000);
            
            showNotification('üíß –ó–∞–ø—É—â–µ–Ω —Ä—É—á–Ω–æ–π –ø–æ–ª–∏–≤ –Ω–∞ ' + currentData.pumpTime + ' —Å–µ–∫—É–Ω–¥', 'success');
        }

        function toggleLightSchedule() {
            const enabled = document.getElementById('lightScheduleEnabled').checked;
            showNotification(enabled ? '‚úÖ –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ —Å–≤–µ—Ç–∞ –≤–∫–ª—é—á–µ–Ω–æ' : '‚úÖ –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ —Å–≤–µ—Ç–∞ –≤—ã–∫–ª—é—á–µ–Ω–æ', 'success');
        }

        function toggleSleepMode() {
            const enabled = document.getElementById('sleepModeEnabled').checked;
            showNotification(enabled ? '‚úÖ –†–µ–∂–∏–º —Å–Ω–∞ –≤–∫–ª—é—á–µ–Ω' : '‚úÖ –†–µ–∂–∏–º —Å–Ω–∞ –≤—ã–∫–ª—é—á–µ–Ω', 'success');
        }

        function toggleNotifications() {
            const enabled = document.getElementById('notificationsEnabled').checked;
            if (enabled && 'Notification' in window) {
                Notification.requestPermission().then(permission => {
                    if (permission === 'granted') {
                        showNotification('‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤–∫–ª—é—á–µ–Ω—ã', 'success');
                    }
                });
            }
        }

        // ============================================
        // –û–®–ò–ë–ö–ò –ò –°–¢–ê–¢–ò–°–¢–ò–ö–ê
        // ============================================
        function updateErrorsList() {
            const errorsContainer = document.getElementById('errorsContainer');
            const errorCount = document.getElementById('errorCount');
            
            if (!currentData.errors || currentData.errors.length === 0) {
                errorsContainer.innerHTML = '<div class="error-item"><div class="error-msg">‚úÖ –û—à–∏–±–æ–∫ –Ω–µ—Ç</div></div>';
                errorCount.textContent = '0';
                return;
            }
            
            errorCount.textContent = currentData.errors.length;
            
            let html = '';
            currentData.errors.slice(0, 10).forEach(error => {
                const time = new Date(error.timestamp * 1000).toLocaleTimeString('ru-RU', {
                    hour: '2-digit',
                    minute: '2-digit'
                });
                
                html += `
                    <div class="error-item">
                        <div class="error-time">
                            <i class="far fa-clock"></i> ${time}
                        </div>
                        <div class="error-msg">${error.message}</div>
                    </div>
                `;
            });
            
            errorsContainer.innerHTML = html;
        }

        function clearErrors() {
            // –ó–¥–µ—Å—å –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –æ—á–∏—Å—Ç–∫—É –æ—à–∏–±–æ–∫ –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ
            showNotification('‚úÖ –û—à–∏–±–∫–∏ –æ—á–∏—â–µ–Ω—ã', 'success');
            document.getElementById('errorCount').textContent = '0';
            document.getElementById('errorsContainer').innerHTML = 
                '<div class="error-item"><div class="error-msg">‚úÖ –û—à–∏–±–æ–∫ –Ω–µ—Ç</div></div>';
        }

        function updateStatistics() {
            // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —Ä–∞—Å—á–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
            // –ü–æ–∫–∞ –∑–∞–≥–ª—É—à–∫–∏
            document.getElementById('totalWaterings').textContent = '125';
            document.getElementById('totalLightHours').textContent = '48—á';
            document.getElementById('totalEnergy').textContent = '240–í—Ç¬∑—á';
            document.getElementById('uptimeValue').textContent = '15–¥';
        }

        function updateWateringTimer() {
            // –ó–∞–≥–ª—É—à–∫–∞ –¥–ª—è —Ç–∞–π–º–µ—Ä–∞
            const nextWatering = 15; // –º–∏–Ω—É—Ç –¥–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ –ø–æ–ª–∏–≤–∞
            document.getElementById('timerValue').textContent = nextWatering;
        }

        // ============================================
        // –¢–ï–ú–ê –ò –í–†–ï–ú–Ø
        // ============================================
        function loadTheme() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);
            updateThemeButton(savedTheme);
        }

        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            
            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            updateThemeButton(newTheme);
            
            showNotification(newTheme === 'dark' ? 'üåô –í–∫–ª—é—á–µ–Ω–∞ —Ç–µ–º–Ω–∞—è —Ç–µ–º–∞' : '‚òÄÔ∏è –í–∫–ª—é—á–µ–Ω–∞ —Å–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞', 'success');
        }

        function updateThemeButton(theme) {
            const button = document.querySelector('.theme-toggle');
            if (theme === 'dark') {
                button.innerHTML = '<i class="fas fa-sun"></i> –°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞';
            } else {
                button.innerHTML = '<i class="fas fa-moon"></i> –¢—ë–º–Ω–∞—è —Ç–µ–º–∞';
            }
        }

        function updateLocalTime() {
            const now = new Date();
            const timeStr = now.toLocaleTimeString('ru-RU', {
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            
            // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –≥–¥–µ-–Ω–∏–±—É–¥—å
        }

        // ============================================
        // –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò
        // ============================================
        function getMoistureColor(moisture) {
            if (moisture < 30) return 'var(--danger-color)';
            if (moisture < 50) return 'var(--warning-color)';
            return 'var(--success-color)';
        }

        function showNotification(message, type = 'info') {
            const notification = document.getElementById('notification');
            const notificationText = document.getElementById('notificationText');
            
            notificationText.textContent = message;
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏–∫–æ–Ω–∫—É
            const icon = notification.querySelector('i');
            if (icon) {
                switch (type) {
                    case 'error':
                        icon.className = 'fas fa-exclamation-circle';
                        notification.className = 'notification error';
                        break;
                    case 'success':
                        icon.className = 'fas fa-check-circle';
                        notification.className = 'notification success';
                        break;
                    case 'warning':
                        icon.className = 'fas fa-exclamation-triangle';
                        notification.className = 'notification warning';
                        break;
                    default:
                        icon.className = 'fas fa-info-circle';
                        notification.className = 'notification';
                }
            }
            
            notification.classList.add('show');
            
            // –ê–≤—Ç–æ—Å–∫—Ä—ã—Ç–∏–µ
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        function refreshData() {
            loadDeviceData();
            loadSettings();
            showNotification('üîÑ –î–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω—ã', 'success');
        }

        // –ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.key === 'r') {
                e.preventDefault();
                refreshData();
            }
            if (e.key === 'Escape') {
                const notification = document.getElementById('notification');
                notification.classList.remove('show');
            }
        });

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ PWA
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js');
            });
        }
    </script>
</body>
</html>
