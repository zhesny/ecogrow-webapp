<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EcoGrow Remote Control</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 1.1rem;
        }
        
        .connection-panel {
            padding: 30px;
            border-bottom: 1px solid #eee;
        }
        
        .input-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #333;
        }
        
        input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
        }
        
        input:focus {
            border-color: #27ae60;
            outline: none;
        }
        
        .btn {
            display: inline-block;
            padding: 12px 24px;
            background: #27ae60;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn:hover {
            background: #219653;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(39, 174, 96, 0.3);
        }
        
        .btn:disabled {
            background: #95a5a6;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .dashboard {
            padding: 30px;
        }
        
        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .status-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            border: 1px solid #eee;
            text-align: center;
        }
        
        .status-icon {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .status-label {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 5px;
        }
        
        .status-value {
            font-size: 2rem;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .controls-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .control-btn {
            padding: 15px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .control-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .btn-pump {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
        }
        
        .btn-light {
            background: linear-gradient(135deg, #f39c12, #e67e22);
            color: white;
        }
        
        .btn-water {
            background: linear-gradient(135deg, #27ae60, #219653);
            color: white;
        }
        
        .btn-auto {
            background: linear-gradient(135deg, #9b59b6, #8e44ad);
            color: white;
        }
        
        .settings-panel {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            margin-top: 20px;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 8px;
            color: white;
            font-weight: bold;
            opacity: 0;
            transform: translateX(100%);
            transition: all 0.3s;
            z-index: 1000;
        }
        
        .notification.show {
            opacity: 1;
            transform: translateX(0);
        }
        
        .notification.success {
            background: #27ae60;
        }
        
        .notification.error {
            background: #e74c3c;
        }
        
        .telegram-panel {
            background: linear-gradient(135deg, #0088cc, #00acee);
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin-top: 20px;
        }
        
        .telegram-panel h3 {
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        @media (max-width: 600px) {
            .container {
                border-radius: 0;
            }
            
            .status-grid {
                grid-template-columns: 1fr;
            }
            
            .controls-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üå± EcoGrow Remote Control</h1>
            <p>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º–æ–π –ø–æ–ª–∏–≤–∞ –∏–∑ –ª—é–±–æ–π —Ç–æ—á–∫–∏ –º–∏—Ä–∞</p>
        </div>
        
        <div class="connection-panel" id="connectionPanel">
            <h2>–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —É—Å—Ç—Ä–æ–π—Å—Ç–≤—É</h2>
            <div class="input-group">
                <label>IP –∞–¥—Ä–µ—Å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞:</label>
                <input type="text" id="deviceIp" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 192.168.1.100">
                <p style="font-size: 0.9rem; color: #666; margin-top: 5px;">
                    –£–∑–Ω–∞—Ç—å IP –º–æ–∂–Ω–æ –≤ Telegram –±–æ—Ç–µ –∫–æ–º–∞–Ω–¥–æ–π /status
                </p>
            </div>
            <div class="input-group">
                <label>–ü–æ—Ä—Ç (–æ–±—ã—á–Ω–æ 80):</label>
                <input type="text" id="devicePort" value="80">
            </div>
            <button class="btn" onclick="connectToDevice()">–ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è</button>
        </div>
        
        <div class="dashboard" id="dashboard" style="display: none;">
            <div class="status-grid">
                <div class="status-card">
                    <div class="status-icon">üíß</div>
                    <div class="status-label">–í–ª–∞–∂–Ω–æ—Å—Ç—å</div>
                    <div class="status-value" id="moistureValue">--%</div>
                </div>
                
                <div class="status-card">
                    <div class="status-icon">üö∞</div>
                    <div class="status-label">–ù–∞—Å–æ—Å</div>
                    <div class="status-value" id="pumpStatus">–í—ã–∫–ª</div>
                </div>
                
                <div class="status-card">
                    <div class="status-icon">üí°</div>
                    <div class="status-label">–°–≤–µ—Ç</div>
                    <div class="status-value" id="lightStatus">–í—ã–∫–ª</div>
                </div>
                
                <div class="status-card">
                    <div class="status-icon">üìä</div>
                    <div class="status-label">–ü–æ–ª–∏–≤–æ–≤</div>
                    <div class="status-value" id="wateringsCount">0</div>
                </div>
            </div>
            
            <div class="controls-grid">
                <button class="control-btn btn-pump" onclick="sendCommand('pump_on')">
                    <span>üö∞</span> –í–∫–ª—é—á–∏—Ç—å –Ω–∞—Å–æ—Å
                </button>
                
                <button class="control-btn btn-pump" onclick="sendCommand('pump_off')">
                    <span>üö∞</span> –í—ã–∫–ª—é—á–∏—Ç—å –Ω–∞—Å–æ—Å
                </button>
                
                <button class="control-btn btn-light" onclick="sendCommand('light_on')">
                    <span>üí°</span> –í–∫–ª—é—á–∏—Ç—å —Å–≤–µ—Ç
                </button>
                
                <button class="control-btn btn-light" onclick="sendCommand('light_off')">
                    <span>üí°</span> –í—ã–∫–ª—é—á–∏—Ç—å —Å–≤–µ—Ç
                </button>
                
                <button class="control-btn btn-water" onclick="sendCommand('water')">
                    <span>üíß</span> –ü–æ–ª–∏—Ç—å —Å–µ–π—á–∞—Å
                </button>
                
                <button class="control-btn btn-auto" onclick="sendCommand('auto')">
                    <span>‚öôÔ∏è</span> –ê–≤—Ç–æ—Ä–µ–∂–∏–º
                </button>
            </div>
            
            <div class="settings-panel">
                <h3>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ—Ä–æ–≥–∞ –≤–ª–∞–∂–Ω–æ—Å—Ç–∏</h3>
                <div style="display: flex; gap: 10px; align-items: center; margin-top: 10px;">
                    <input type="range" id="thresholdSlider" min="10" max="90" value="50" style="flex: 1;">
                    <span id="thresholdValue" style="font-size: 1.2rem; font-weight: bold;">50%</span>
                    <button class="btn" onclick="setThreshold()" style="padding: 10px 20px;">
                        –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
                    </button>
                </div>
            </div>
            
            <div class="telegram-panel">
                <h3><span>ü§ñ</span> Telegram —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</h3>
                <p>–î–ª—è —É–¥–∞–ª–µ–Ω–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∏–∑ –ª—é–±–æ–π —Ç–æ—á–∫–∏ –º–∏—Ä–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ Telegram –±–æ—Ç–∞:</p>
                <p style="margin-top: 10px;">
                    <strong>–ë–æ—Ç:</strong> @EcoGrow_assis_Bot<br>
                    <strong>–ö–æ–º–∞–Ω–¥—ã:</strong> /status, /pump_on, /pump_off, /water, /light_on, /light_off
                </p>
                <p style="margin-top: 10px; font-size: 0.9rem;">
                    Telegram —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–∞–∂–µ –±–µ–∑ –ø—Ä—è–º–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ IP –∞–¥—Ä–µ—Å—É —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞!
                </p>
            </div>
        </div>
    </div>
    
    <div class="notification" id="notification"></div>
    
    <script>
        let deviceIp = '';
        let devicePort = 80;
        let updateInterval;
        
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type} show`;
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }
        
        function connectToDevice() {
            deviceIp = document.getElementById('deviceIp').value.trim();
            devicePort = document.getElementById('devicePort').value.trim();
            
            if (!deviceIp) {
                showNotification('–í–≤–µ–¥–∏—Ç–µ IP –∞–¥—Ä–µ—Å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞', 'error');
                return;
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
            fetch(`http://${deviceIp}:${devicePort}/status`, { mode: 'no-cors' })
                .then(() => {
                    // –ï—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–æ, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
                    document.getElementById('connectionPanel').style.display = 'none';
                    document.getElementById('dashboard').style.display = 'block';
                    showNotification('–£—Å–ø–µ—à–Ω–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ —É—Å—Ç—Ä–æ–π—Å—Ç–≤—É!');
                    
                    // –ù–∞—á–∏–Ω–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞
                    startStatusUpdates();
                })
                .catch(error => {
                    showNotification('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —É—Å—Ç—Ä–æ–π—Å—Ç–≤—É', 'error');
                    console.error('Connection error:', error);
                });
        }
        
        function sendCommand(command) {
            fetch(`http://${deviceIp}:${devicePort}/command?cmd=${command}`)
                .then(response => response.text())
                .then(message => {
                    showNotification(message);
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –ø–æ—Å–ª–µ –∫–æ–º–∞–Ω–¥—ã
                    updateStatus();
                })
                .catch(error => {
                    showNotification('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∫–æ–º–∞–Ω–¥—ã', 'error');
                    console.error('Command error:', error);
                });
        }
        
        function updateStatus() {
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º JSONP –∏–ª–∏ –ø—Ä–æ–∫—Å–∏ –¥–ª—è –æ–±—Ö–æ–¥–∞ CORS
            const script = document.createElement('script');
            script.src = `http://${deviceIp}:${devicePort}/status?callback=handleStatus`;
            document.head.appendChild(script);
            setTimeout(() => document.head.removeChild(script), 1000);
        }
        
        function handleStatus(data) {
            // –û–±–Ω–æ–≤–ª—è–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
            document.getElementById('moistureValue').textContent = data.moisture + '%';
            document.getElementById('pumpStatus').textContent = data.pump ? '–í–∫–ª' : '–í—ã–∫–ª';
            document.getElementById('lightStatus').textContent = data.light ? '–í–∫–ª' : '–í—ã–∫–ª';
            document.getElementById('wateringsCount').textContent = data.waterings;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ª–∞–π–¥–µ—Ä –ø–æ—Ä–æ–≥–∞
            const slider = document.getElementById('thresholdSlider');
            const valueSpan = document.getElementById('thresholdValue');
            if (data.threshold) {
                slider.value = data.threshold;
                valueSpan.textContent = data.threshold + '%';
            }
        }
        
        function startStatusUpdates() {
            // –ü–µ—Ä–≤–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
            updateStatus();
            
            // –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
            if (updateInterval) {
                clearInterval(updateInterval);
            }
            updateInterval = setInterval(updateStatus, 5000);
        }
        
        function setThreshold() {
            const threshold = document.getElementById('thresholdSlider').value;
            fetch(`http://${deviceIp}:${devicePort}/command?cmd=set_threshold&value=${threshold}`)
                .then(response => response.text())
                .then(message => {
                    showNotification(message);
                    document.getElementById('thresholdValue').textContent = threshold + '%';
                })
                .catch(error => {
                    showNotification('–û—à–∏–±–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø–æ—Ä–æ–≥–∞', 'error');
                });
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–ª–∞–π–¥–µ—Ä–∞
        document.getElementById('thresholdSlider').addEventListener('input', function() {
            document.getElementById('thresholdValue').textContent = this.value + '%';
        });
        
        // –ü—Ä–æ–±—É–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –ª–æ–∫–∞–ª—å–Ω–æ–º—É —É—Å—Ç—Ä–æ–π—Å—Ç–≤—É
        window.onload = function() {
            // –ü–æ–ø—ã—Ç–∫–∞ –Ω–∞–π—Ç–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –≤ –ª–æ–∫–∞–ª—å–Ω–æ–π —Å–µ—Ç–∏
            const possibleIps = ['192.168.1.100', '192.168.0.100', '192.168.1.1', '192.168.0.1'];
            
            // –ï—Å–ª–∏ –µ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π IP –≤ localStorage
            const savedIp = localStorage.getItem('ecogrow_ip');
            if (savedIp) {
                document.getElementById('deviceIp').value = savedIp;
            }
        };
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º IP –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏
        function saveDeviceIp(ip) {
            localStorage.setItem('ecogrow_ip', ip);
        }
    </script>
</body>
</html>
