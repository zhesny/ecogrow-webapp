<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üå± EcoGrow Control</title>
    
    <!-- Firebase SDK (COMPAT –≤–µ—Ä—Å–∏—è) -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 25px;
            text-align: center;
        }
        
        .header h1 {
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .debug-panel {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 25px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .debug-panel h2 {
            color: #e74c3c;
            margin-bottom: 15px;
        }
        
        .debug-info {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            font-family: monospace;
            font-size: 0.9rem;
            max-height: 200px;
            overflow-y: auto;
            margin-bottom: 15px;
        }
        
        .device-panel {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .devices-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .device-card {
            background: white;
            border: 2px solid #e1e8ed;
            border-radius: 12px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .device-card:hover {
            border-color: #27ae60;
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1);
        }
        
        .device-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .device-name {
            font-size: 1.2rem;
            font-weight: 600;
            color: #2c3e50;
        }
        
        .device-status {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }
        
        .status-online {
            background: rgba(39, 174, 96, 0.15);
            color: #27ae60;
        }
        
        .status-offline {
            background: rgba(231, 76, 60, 0.15);
            color: #e74c3c;
        }
        
        .device-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .info-item {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 8px;
            text-align: center;
        }
        
        .info-label {
            font-size: 0.8rem;
            color: #7f8c8d;
            margin-bottom: 5px;
        }
        
        .info-value {
            font-size: 1.2rem;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        
        .btn {
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(52, 152, 219, 0.3);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #27ae60, #229954);
            color: white;
        }
        
        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(39, 174, 96, 0.3);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
        }
        
        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(231, 76, 60, 0.3);
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            transform: translateX(120%);
            transition: transform 0.3s ease-out;
            z-index: 1000;
            border-left: 5px solid #27ae60;
            max-width: 400px;
            font-weight: 500;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification.error {
            border-left-color: #e74c3c;
        }
        
        @media (max-width: 768px) {
            .devices-list {
                grid-template-columns: 1fr;
            }
            
            .controls {
                grid-template-columns: 1fr;
            }
            
            .device-info {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- –®–ê–ü–ö–ê -->
        <div class="header">
            <h1>üå± EcoGrow Remote Control</h1>
            <p id="connectionStatus">üîå –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Firebase...</p>
        </div>
        
        <!-- –ü–ê–ù–ï–õ–¨ –û–¢–õ–ê–î–ö–ò -->
        <div class="debug-panel" id="debugPanel" style="display: none;">
            <h2>üêõ –ü–∞–Ω–µ–ª—å –æ—Ç–ª–∞–¥–∫–∏</h2>
            <div class="debug-info" id="debugInfo">
                –ó–∞–≥—Ä—É–∑–∫–∞ –æ—Ç–ª–∞–¥–æ—á–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏...
            </div>
            <div class="controls">
                <button class="btn btn-primary" onclick="checkFirebaseConnection()">
                    üîÑ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
                </button>
                <button class="btn btn-danger" onclick="hideDebug()">
                    ‚ùå –°–∫—Ä—ã—Ç—å –æ—Ç–ª–∞–¥–∫—É
                </button>
            </div>
        </div>
        
        <!-- –í–´–ë–û–† –£–°–¢–†–û–ô–°–¢–í–ê -->
        <div class="device-panel">
            <h2>üì± –î–æ—Å—Ç—É–ø–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞</h2>
            <p id="devicesCount">–ü–æ–∏—Å–∫ —É—Å—Ç—Ä–æ–π—Å—Ç–≤...</p>
            <div id="devicesList" class="devices-list">
                <!-- –£—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å -->
            </div>
            <div class="controls" style="margin-top: 20px;">
                <button class="btn btn-primary" onclick="showDebug()">
                    üêõ –ü–æ–∫–∞–∑–∞—Ç—å –æ—Ç–ª–∞–¥–∫—É
                </button>
                <button class="btn btn-success" onclick="forceRefresh()">
                    üîÑ –û–±–Ω–æ–≤–∏—Ç—å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
                </button>
            </div>
        </div>
        
        <!-- –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø -->
        <div id="notification" class="notification"></div>
    </div>

    <script>
        // ============================================
        // –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø FIREBASE
        // ============================================
        const firebaseConfig = {
            apiKey: "AIzaSyBJSFgQqIrsXj88Xq9h_vwzWjsbZq3z7r8",
            authDomain: "ecogrow-remote.firebaseapp.com",
            databaseURL: "https://ecogrow-remote-default-rtdb.firebaseio.com",
            projectId: "ecogrow-remote",
            storageBucket: "ecogrow-remote.appspot.com",
            messagingSenderId: "123456789012",
            appId: "1:123456789012:web:abcdef1234567890abcdef"
        };

        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let database = null;
        let currentDeviceId = null;
        let debugMode = false;

        // ============================================
        // –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø
        // ============================================
        document.addEventListener('DOMContentLoaded', function() {
            console.log("–°–∞–π—Ç –∑–∞–≥—Ä—É–∂–µ–Ω, –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º Firebase...");
            showNotification('üåê –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Firebase...');
            
            try {
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase
                const app = firebase.initializeApp(firebaseConfig);
                database = firebase.database();
                console.log("‚úÖ Firebase –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω");
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Firebase
                checkFirebaseConnection();
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
                loadDevices();
                
                // –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥
                setInterval(() => {
                    if (debugMode) updateDebugInfo();
                }, 10000);
                
            } catch (error) {
                console.error("‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Firebase:", error);
                showNotification(`‚ùå –û—à–∏–±–∫–∞ Firebase: ${error.message}`, true);
            }
        });

        // ============================================
        // –û–¢–õ–ê–î–û–ß–ù–´–ï –§–£–ù–ö–¶–ò–ò
        // ============================================
        
        function showDebug() {
            debugMode = true;
            document.getElementById('debugPanel').style.display = 'block';
            updateDebugInfo();
        }
        
        function hideDebug() {
            debugMode = false;
            document.getElementById('debugPanel').style.display = 'none';
        }
        
        function updateDebugInfo() {
            if (!debugMode) return;
            if (!database) return;
            
            const debugInfo = document.getElementById('debugInfo');
            let info = `=== –ò–ù–§–û–†–ú–ê–¶–ò–Ø –û–¢–õ–ê–î–ö–ò ===\n\n`;
            
            info += `Firebase config loaded: ${firebaseConfig ? '‚úÖ' : '‚ùå'}\n`;
            info += `Database URL: ${firebaseConfig.databaseURL}\n`;
            info += `Current time: ${new Date().toLocaleTimeString()}\n`;
            info += `Current device: ${currentDeviceId || '–Ω–µ—Ç'}\n`;
            info += `Debug mode: ${debugMode ? '‚úÖ –í–ö–õ' : '‚ùå –í–´–ö–õ'}\n`;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å Firebase
            database.ref('.info/connected').once('value')
                .then(snapshot => {
                    const connected = snapshot.val();
                    info += `Firebase connected: ${connected ? '‚úÖ' : '‚ùå'}\n`;
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –¥–∞–Ω–Ω—ã—Ö
                    return database.ref('devices').once('value');
                })
                .then(snapshot => {
                    const devices = snapshot.val();
                    info += `Devices in database: ${devices ? Object.keys(devices).length : 0}\n`;
                    
                    if (devices) {
                        info += `\n=== –°–ü–ò–°–û–ö –£–°–¢–†–û–ô–°–¢–í ===\n`;
                        for (const deviceId in devices) {
                            const device = devices[deviceId];
                            const isOnline = isDeviceOnline(device);
                            info += `\n${deviceId}:\n`;
                            info += `  Name: ${device.name || '–Ω–µ—Ç'}\n`;
                            info += `  IP: ${device.ip || '–Ω–µ—Ç'}\n`;
                            info += `  Status: ${device.status || 'unknown'}\n`;
                            info += `  Online: ${isOnline ? '‚úÖ' : '‚ùå'}\n`;
                            info += `  Last seen: ${device.lastSeen ? new Date(device.lastSeen * 1000).toLocaleTimeString() : 'never'}\n`;
                            
                            if (device.data) {
                                info += `  Data:\n`;
                                info += `    Moisture: ${device.data.moisture || '--'}%\n`;
                                info += `    Pump: ${device.data.pump ? 'ON' : 'OFF'}\n`;
                                info += `    Light: ${device.data.light ? 'ON' : 'OFF'}\n`;
                                info += `    Timestamp: ${device.data.timestamp ? new Date(device.data.timestamp * 1000).toLocaleTimeString() : 'never'}\n`;
                            }
                        }
                    }
                    
                    debugInfo.textContent = info;
                })
                .catch(error => {
                    info += `\n=== –û–®–ò–ë–ö–ê ===\n${error.message}\n`;
                    debugInfo.textContent = info;
                });
        }
        
        function checkFirebaseConnection() {
            if (!database) {
                showNotification('‚ùå Firebase –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω', true);
                return;
            }
            
            console.log("–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Firebase...");
            showNotification('üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Firebase...');
            
            database.ref('.info/connected').once('value')
                .then(snapshot => {
                    const connected = snapshot.val();
                    if (connected) {
                        console.log("‚úÖ Firebase –ø–æ–¥–∫–ª—é—á–µ–Ω!");
                        document.getElementById('connectionStatus').innerHTML = '‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ Firebase';
                        showNotification('‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ Firebase');
                    } else {
                        console.log("‚ùå Firebase –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω");
                        document.getElementById('connectionStatus').innerHTML = '‚ùå –ù–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Firebase';
                        showNotification('‚ùå –ù–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Firebase', true);
                    }
                })
                .catch(error => {
                    console.error("–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Firebase:", error);
                    document.getElementById('connectionStatus').innerHTML = '‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Firebase';
                    showNotification(`‚ùå –û—à–∏–±–∫–∞: ${error.message}`, true);
                });
        }
        
        // ============================================
        // –£–ü–†–ê–í–õ–ï–ù–ò–ï –£–°–¢–†–û–ô–°–¢–í–ê–ú–ò
        // ============================================
        
        function loadDevices() {
            if (!database) {
                console.error("‚ùå –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞");
                showNotification('‚ùå Firebase –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω', true);
                return;
            }
            
            console.log("–ó–∞–≥—Ä—É–∑–∫–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –∏–∑ Firebase...");
            
            const devicesRef = database.ref('devices');
            
            devicesRef.on('value', (snapshot) => {
                const devices = snapshot.val();
                const devicesList = document.getElementById('devicesList');
                const devicesCount = document.getElementById('devicesCount');
                
                console.log("–ü–æ–ª—É—á–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ –∏–∑ Firebase:", devices);
                
                if (!devices || Object.keys(devices).length === 0) {
                    devicesList.innerHTML = `
                        <div style="grid-column: 1/-1; text-align: center; padding: 40px; color: #7f8c8d;">
                            <h3>üì≠ –£—Å—Ç—Ä–æ–π—Å—Ç–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</h3>
                            <p style="margin-top: 10px;">–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:</p>
                            <ul style="text-align: left; display: inline-block; margin-top: 10px;">
                                <li>ESP8266 –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É</li>
                                <li>ESP8266 –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ Firebase</li>
                                <li>–ü—Ä–æ–±–ª–µ–º—ã —Å –ø—Ä–∞–≤–∏–ª–∞–º–∏ –¥–æ—Å—Ç—É–ø–∞ Firebase</li>
                                <li>–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Firebase</li>
                            </ul>
                            <p style="margin-top: 20px;">–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–∞–Ω–µ–ª—å –æ—Ç–ª–∞–¥–∫–∏ –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏</p>
                        </div>
                    `;
                    devicesCount.textContent = '–£—Å—Ç—Ä–æ–π—Å—Ç–≤: 0';
                    return;
                }
                
                let html = '';
                let onlineCount = 0;
                
                for (const deviceId in devices) {
                    const device = devices[deviceId];
                    const isOnline = isDeviceOnline(device);
                    if (isOnline) onlineCount++;
                    
                    const isSelected = deviceId === currentDeviceId;
                    
                    html += `
                        <div class="device-card" onclick="selectDevice('${deviceId}')" 
                             style="${isSelected ? 'border-color: #27ae60; background: rgba(39, 174, 96, 0.05);' : ''}">
                            <div class="device-header">
                                <div class="device-name">${device.name || '–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ ' + deviceId}</div>
                                <div class="device-status ${isOnline ? 'status-online' : 'status-offline'}">
                                    ${isOnline ? 'üü¢ –û–Ω–ª–∞–π–Ω' : 'üî¥ –û—Ñ—Ñ–ª–∞–π–Ω'}
                                </div>
                            </div>
                            <div class="device-info">
                                <div class="info-item">
                                    <div class="info-label">–í–ª–∞–∂–Ω–æ—Å—Ç—å</div>
                                    <div class="info-value">${device.data?.moisture || '--'}%</div>
                                </div>
                                <div class="info-item">
                                    <div class="info-label">–ù–∞—Å–æ—Å</div>
                                    <div class="info-value">${device.data?.pump ? '–í–ö–õ' : '–í–´–ö–õ'}</div>
                                </div>
                            </div>
                            <div class="device-info">
                                <div class="info-item">
                                    <div class="info-label">–°–≤–µ—Ç</div>
                                    <div class="info-value">${device.data?.light ? '–í–ö–õ' : '–í–´–ö–õ'}</div>
                                </div>
                                <div class="info-item">
                                    <div class="info-label">IP</div>
                                    <div class="info-value" style="font-size: 0.9rem;">${device.ip || '--'}</div>
                                </div>
                            </div>
                            ${isOnline ? `
                                <div class="controls" style="margin-top: 15px;">
                                    <button class="btn btn-success" onclick="event.stopPropagation(); sendCommand('${deviceId}', 'pump', 1)">
                                        üíß –í–∫–ª—é—á–∏—Ç—å –Ω–∞—Å–æ—Å
                                    </button>
                                    <button class="btn btn-danger" onclick="event.stopPropagation(); sendCommand('${deviceId}', 'pump', 0)">
                                        ‚õî –í—ã–∫–ª—é—á–∏—Ç—å
                                    </button>
                                </div>
                            ` : ''}
                        </div>
                    `;
                }
                
                devicesList.innerHTML = html;
                devicesCount.textContent = `–£—Å—Ç—Ä–æ–π—Å—Ç–≤: ${Object.keys(devices).length} (${onlineCount} –æ–Ω–ª–∞–π–Ω)`;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–ª–∞–¥–æ—á–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
                if (debugMode) updateDebugInfo();
            }, (error) => {
                console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤:", error);
                devicesCount.textContent = '‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤';
                showNotification(`‚ùå –û—à–∏–±–∫–∞: ${error.message}`, true);
            });
        }
        
        function isDeviceOnline(device) {
            if (!device.data || !device.data.timestamp) return false;
            const now = Math.floor(Date.now() / 1000);
            const deviceTime = device.data.timestamp;
            return (now - deviceTime) < 120; // 2 –º–∏–Ω—É—Ç—ã
        }
        
        function selectDevice(deviceId) {
            currentDeviceId = deviceId;
            showNotification(`‚úÖ –í—ã–±—Ä–∞–Ω–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ: ${deviceId}`);
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
            window.location.href = `control.html?device=${deviceId}`;
        }
        
        function forceRefresh() {
            console.log("–ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤...");
            loadDevices();
            showNotification('üîÑ –£—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –æ–±–Ω–æ–≤–ª–µ–Ω—ã');
        }
        
        function sendCommand(deviceId, command, value) {
            if (!database) {
                showNotification('‚ùå Firebase –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω', true);
                return;
            }
            
            if (!deviceId) {
                showNotification('‚ùå –°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ', true);
                return;
            }
            
            console.log(`–û—Ç–ø—Ä–∞–≤–∫–∞ –∫–æ–º–∞–Ω–¥—ã: ${command}=${value} –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ ${deviceId}`);
            
            database.ref('devices/' + deviceId + '/commands/latest').set({
                command: command,
                value: value,
                timestamp: Date.now(),
                source: 'web'
            })
            .then(() => {
                showNotification(`‚úÖ –ö–æ–º–∞–Ω–¥–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞: ${command}=${value}`);
            })
            .catch(error => {
                console.error("–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∫–æ–º–∞–Ω–¥—ã:", error);
                showNotification(`‚ùå –û—à–∏–±–∫–∞: ${error.message}`, true);
            });
        }
        
        // ============================================
        // –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò
        // ============================================
        
        function showNotification(message, isError = false) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${isError ? 'error' : ''} show`;
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }
    </script>
</body>
</html>
