<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EcoGrow Assistant - Система умного полива</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&family=Roboto+Mono:wght@300;400&display=swap">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    
    <link rel="stylesheet" href="styles.css">
</head>
<body class="dark-theme">
    <!-- Preloader -->
    <div class="preloader">
        <div class="preloader-content">
            <div class="leaf-spinner">
                <div class="leaf leaf1"></div>
                <div class="leaf leaf2"></div>
                <div class="leaf leaf3"></div>
            </div>
            <p>Загрузка EcoGrow Assistant...</p>
        </div>
    </div>

    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="logo-section">
                    <div class="logo">
                        <i class="fas fa-seedling"></i>
                        <h1>EcoGrow<span>Assistant</span></h1>
                    </div>
                    <div class="creator-info">
                        <p><i class="fas fa-user-graduate"></i> Купченя Евгений Андреевич</p>
                        <p><i class="fas fa-star"></i> Ученик 9 класса</p>
                    </div>
                </div>
                
                <div class="header-controls">
                    <div class="connection-status">
                        <div class="status-indicator" id="connectionStatus">
                            <span class="status-dot"></span>
                            <span>Подключение...</span>
                        </div>
                        <div class="last-update" id="lastUpdate"></div>
                    </div>
                    
                    <div class="theme-switch">
                        <label class="switch">
                            <input type="checkbox" id="themeToggle">
                            <span class="slider">
                                <i class="fas fa-sun"></i>
                                <i class="fas fa-moon"></i>
                            </span>
                        </label>
                    </div>
                    
                    <button class="sleep-mode-btn" id="sleepModeBtn">
                        <i class="fas fa-moon"></i>
                        Режим сна
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <div class="container">
            <!-- Top Stats Row -->
            <div class="top-stats-row">
                <div class="stat-card primary">
                    <div class="stat-icon">
                        <i class="fas fa-tint"></i>
                    </div>
                    <div class="stat-content">
                        <h3>Влажность</h3>
                        <div class="stat-value" id="moistureValue">--%</div>
                        <div class="stat-trend">
                            <span id="moistureTrend">↗ Норма</span>
                        </div>
                    </div>
                    <div class="stat-graph">
                        <canvas id="miniMoistureChart" width="80" height="40"></canvas>
                    </div>
                </div>
                
                <div class="stat-card secondary">
                    <div class="stat-icon">
                        <i class="fas fa-temperature-high"></i>
                    </div>
                    <div class="stat-content">
                        <h3>Температура</h3>
                        <div class="stat-value" id="temperatureValue">--°C</div>
                        <div class="stat-subtext">Оптимально: 22-26°C</div>
                    </div>
                </div>
                
                <div class="stat-card warning">
                    <div class="stat-icon">
                        <i class="fas fa-sun"></i>
                    </div>
                    <div class="stat-content">
                        <h3>Свет</h3>
                        <div class="stat-value" id="lightStatus">ВЫКЛ</div>
                        <div class="stat-subtext" id="lightTimer">--:--</div>
                    </div>
                </div>
                
                <div class="stat-card success">
                    <div class="stat-icon">
                        <i class="fas fa-water"></i>
                    </div>
                    <div class="stat-content">
                        <h3>Насос</h3>
                        <div class="stat-value" id="pumpStatus">ВЫКЛ</div>
                        <div class="stat-subtext" id="nextWatering">--:--</div>
                    </div>
                </div>
            </div>

            <!-- Main Content Grid -->
            <div class="content-grid">
                <!-- Left Column -->
                <div class="left-column">
                    <!-- Moisture Chart -->
                    <div class="chart-container">
                        <div class="chart-header">
                            <h2><i class="fas fa-chart-line"></i> График влажности</h2>
                            <div class="time-range">
                                <button class="time-btn active" data-range="1h">1ч</button>
                                <button class="time-btn" data-range="6h">6ч</button>
                                <button class="time-btn" data-range="24h">24ч</button>
                                <button class="time-btn" data-range="7d">7д</button>
                            </div>
                        </div>
                        <div class="chart-wrapper">
                            <canvas id="moistureChart"></canvas>
                        </div>
                        <div class="chart-stats">
                            <div class="chart-stat">
                                <span class="label">Средняя:</span>
                                <span class="value" id="avgMoisture">--%</span>
                            </div>
                            <div class="chart-stat">
                                <span class="label">Мин:</span>
                                <span class="value" id="minMoisture">--%</span>
                            </div>
                            <div class="chart-stat">
                                <span class="label">Макс:</span>
                                <span class="value" id="maxMoisture">--%</span>
                            </div>
                            <div class="chart-stat">
                                <span class="label">Тренд:</span>
                                <span class="value trend-up" id="moistureTrendValue">↗ Рост</span>
                            </div>
                        </div>
                    </div>

                    <!-- Controls -->
                    <div class="controls-container">
                        <h2><i class="fas fa-sliders-h"></i> Управление системой</h2>
                        <div class="controls-grid">
                            <div class="control-group">
                                <h3><i class="fas fa-cogs"></i> Автополив</h3>
                                <div class="toggle-switch">
                                    <label>
                                        <input type="checkbox" id="autoWateringToggle" checked>
                                        <span class="toggle-slider"></span>
                                        <span class="toggle-label">Автополив включен</span>
                                    </label>
                                </div>
                                
                                <div class="slider-control">
                                    <label for="moistureThreshold">Порог влажности:</label>
                                    <div class="slider-wrapper">
                                        <input type="range" id="moistureThreshold" min="10" max="90" value="50" class="slider">
                                        <span class="slider-value" id="thresholdValue">50%</span>
                                    </div>
                                </div>
                                
                                <div class="number-input">
                                    <label for="pumpDuration">Длительность полива (сек):</label>
                                    <input type="number" id="pumpDuration" min="1" max="600" value="10">
                                </div>
                                
                                <div class="number-input">
                                    <label for="checkInterval">Интервал проверки (мин):</label>
                                    <input type="number" id="checkInterval" min="1" max="60" value="10">
                                </div>
                            </div>
                            
                            <div class="control-group">
                                <h3><i class="fas fa-hand-paper"></i> Ручное управление</h3>
                                <div class="manual-controls">
                                    <button class="control-btn pump-btn" id="manualPumpBtn">
                                        <i class="fas fa-water"></i>
                                        <span>Включить насос</span>
                                    </button>
                                    <button class="control-btn light-btn" id="manualLightBtn">
                                        <i class="fas fa-lightbulb"></i>
                                        <span>Включить свет</span>
                                    </button>
                                    <div class="timer-control">
                                        <label>Таймер (сек):</label>
                                        <input type="number" id="manualTimer" min="5" max="300" value="10">
                                    </div>
                                </div>
                                
                                <div class="pump-block">
                                    <h4><i class="fas fa-ban"></i> Блокировка полива</h4>
                                    <div class="time-inputs">
                                        <div class="time-input">
                                            <label>С:</label>
                                            <input type="time" id="blockStart" value="23:00">
                                        </div>
                                        <div class="time-input">
                                            <label>До:</label>
                                            <input type="time" id="blockEnd" value="08:00">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Right Column -->
                <div class="right-column">
                    <!-- System Status -->
                    <div class="status-container">
                        <h2><i class="fas fa-heartbeat"></i> Статус системы</h2>
                        <div class="status-list">
                            <div class="status-item online">
                                <i class="fas fa-microchip"></i>
                                <span>Arduino UNO</span>
                                <span class="status-badge" id="arduinoStatus">Офлайн</span>
                            </div>
                            <div class="status-item online">
                                <i class="fas fa-wifi"></i>
                                <span>WiFi модуль</span>
                                <span class="status-badge" id="wifiStatus">Подключен</span>
                            </div>
                            <div class="status-item warning">
                                <i class="fas fa-tachometer-alt"></i>
                                <span>Датчик влажности</span>
                                <span class="status-badge" id="sensorStatus">Загрузка...</span>
                            </div>
                            <div class="status-item online">
                                <i class="fas fa-clock"></i>
                                <span>Часы RTC</span>
                                <span class="status-badge" id="rtcStatus">Синхронизация</span>
                            </div>
                        </div>
                        
                        <div class="time-sync">
                            <h4><i class="fas fa-clock"></i> Системное время</h4>
                            <div class="current-time" id="currentTime">--:--:--</div>
                            <button class="sync-btn" id="syncTimeBtn">
                                <i class="fas fa-sync-alt"></i> Синхронизировать
                            </button>
                        </div>
                    </div>

                    <!-- Statistics -->
                    <div class="stats-container">
                        <h2><i class="fas fa-chart-bar"></i> Статистика</h2>
                        <div class="stats-grid">
                            <div class="stat-item">
                                <div class="stat-icon">
                                    <i class="fas fa-tint"></i>
                                </div>
                                <div class="stat-details">
                                    <div class="stat-title">Поливов сегодня</div>
                                    <div class="stat-number" id="wateringsToday">0</div>
                                </div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-icon">
                                    <i class="fas fa-sun"></i>
                                </div>
                                <div class="stat-details">
                                    <div class="stat-title">Часов света</div>
                                    <div class="stat-number" id="lightHours">0</div>
                                </div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-icon">
                                    <i class="fas fa-bolt"></i>
                                </div>
                                <div class="stat-details">
                                    <div class="stat-title">Экономия воды</div>
                                    <div class="stat-number" id="waterSaved">0л</div>
                                </div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-icon">
                                    <i class="fas fa-calendar-day"></i>
                                </div>
                                <div class="stat-details">
                                    <div class="stat-title">Дней работы</div>
                                    <div class="stat-number" id="daysRunning">1</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="progress-stats">
                            <div class="progress-item">
                                <div class="progress-header">
                                    <span>Эффективность полива</span>
                                    <span id="efficiencyValue">85%</span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: 85%"></div>
                                </div>
                            </div>
                            <div class="progress-item">
                                <div class="progress-header">
                                    <span>Загрузка системы</span>
                                    <span id="systemLoad">42%</span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: 42%"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Telegram Notifications -->
                    <div class="telegram-container">
                        <div class="telegram-header">
                            <h2><i class="fab fa-telegram"></i> Telegram уведомления</h2>
                            <label class="switch small">
                                <input type="checkbox" id="telegramToggle" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                        
                        <div class="telegram-info">
                            <p><i class="fas fa-robot"></i> Бот: @EcoGrow_assis_Bot</p>
                            <p><i class="fas fa-bell"></i> Уведомления включены</p>
                        </div>
                        
                        <div class="notification-types">
                            <label class="checkbox-label">
                                <input type="checkbox" checked> Критическая влажность
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" checked> Начало полива
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" checked> Ошибки системы
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox"> Ежедневный отчет
                            </label>
                        </div>
                        
                        <button class="test-notification-btn" id="testNotificationBtn">
                            <i class="fas fa-paper-plane"></i> Тестовое уведомление
                        </button>
                    </div>

                    <!-- Error History -->
                    <div class="errors-container">
                        <div class="errors-header">
                            <h2><i class="fas fa-exclamation-triangle"></i> История ошибок</h2>
                            <button class="clear-btn" id="clearErrorsBtn">
                                <i class="fas fa-trash"></i> Очистить
                            </button>
                        </div>
                        
                        <div class="errors-list" id="errorsList">
                            <!-- Errors will be dynamically added here -->
                        </div>
                        
                        <div class="no-errors" id="noErrors">
                            <i class="fas fa-check-circle"></i>
                            <p>Ошибок не обнаружено</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Auto Light Schedule -->
            <div class="schedule-container">
                <h2><i class="fas fa-calendar-alt"></i> Расписание освещения</h2>
                <div class="schedule-controls">
                    <div class="schedule-input">
                        <label>Начало освещения:</label>
                        <input type="time" id="lightStartTime" value="08:00">
                    </div>
                    <div class="schedule-input">
                        <label>Длительность (часы):</label>
                        <input type="number" id="lightDuration" min="1" max="24" value="12">
                    </div>
                    <button class="apply-btn" id="applyScheduleBtn">
                        <i class="fas fa-check"></i> Применить
                    </button>
                </div>
                
                <div class="schedule-visual">
                    <div class="timeline">
                        <!-- Timeline will be filled dynamically -->
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-info">
                    <h3>EcoGrow Assistant v4.5</h3>
                    <p>Система автоматического полива растений с интеллектуальным управлением</p>
                    <div class="contact-info">
                        <p><i class="fas fa-envelope"></i> zhenya.kupchenya@mail.ru</p>
                        <p><i class="fab fa-telegram"></i> @Zhesny</p>
                        <p><i class="fas fa-graduation-cap"></i> Ученик 9 класса</p>
                    </div>
                </div>
                
                <div class="footer-links">
                    <h4>Быстрые ссылки</h4>
                    <a href="#"><i class="fas fa-book"></i> Документация</a>
                    <a href="#"><i class="fas fa-code"></i> Исходный код</a>
                    <a href="#"><i class="fas fa-question-circle"></i> Помощь</a>
                    <a href="#"><i class="fas fa-bug"></i> Сообщить об ошибке</a>
                </div>
                
                <div class="system-info">
                    <h4>Системная информация</h4>
                    <p>Версия прошивки: 4.5.1</p>
                    <p>Последнее обновление: <span id="lastSystemUpdate">--</span></p>
                    <p>Потребление RAM: <span id="ramUsage">--</span></p>
                    <p>Аптайм: <span id="uptime">--</span></p>
                </div>
            </div>
            
            <div class="copyright">
                <p>© 2024 EcoGrow Assistant. Разработано Купченя Евгением. Все права защищены.</p>
            </div>
        </div>
    </footer>

    <!-- Toast Notifications -->
    <div id="toastContainer"></div>

    <!-- Modals -->
    <div class="modal" id="sleepModeModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-moon"></i> Режим сна</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <p>Вы уверены, что хотите перевести систему в режим сна? Все автоматические функции будут отключены.</p>
                <div class="modal-input">
                    <label>Длительность сна (часы):</label>
                    <input type="number" id="sleepDuration" min="1" max="24" value="8">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary close-modal">Отмена</button>
                <button class="btn-danger" id="confirmSleepBtn">Включить режим сна</button>
            </div>
        </div>
    </div>

    <!-- Firebase Configuration -->
    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBsZr7vWJDFt_S5i0Rvj6ejp6QT0JX9SPk",
            authDomain: "ecogrow-remote.firebaseapp.com",
            databaseURL: "https://ecogrow-remote-default-rtdb.firebaseio.com",
            projectId: "ecogrow-remote",
            storageBucket: "ecogrow-remote.firebasestorage.app",
            messagingSenderId: "121689275158",
            appId: "1:121689275158:web:f3b1829755c8b8a1fb2e37",
            measurementId: "G-PG5116NH38"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        
        // Make database available globally
        window.firebaseDatabase = database;
    </script>
    
    <!-- Main Script -->
    <script src="app.js"></script>
</body>
</html>
